[
    {
        "id": "d833cbb1fb389561",
        "type": "tab",
        "label": "Wormhole server",
        "disabled": false,
        "info": "",
        "env": [
            {
                "name": "API_KEYS_PATH",
                "value": "/common/wormhole/config/api-keys.yaml",
                "type": "str"
            },
            {
                "name": "CONFIGS_PATH",
                "value": "/common/wormhole/config/configs.yaml",
                "type": "str"
            },
            {
                "name": "DEVICES_PATH",
                "value": "/common/wormhole/config/devices.yaml",
                "type": "str"
            },
            {
                "name": "LOG_DIR_PATH",
                "value": "/common/wormhole/logs",
                "type": "str"
            },
            {
                "name": "SCRIPTS_PATH",
                "value": "/common/wormhole/scripts",
                "type": "str"
            },
            {
                "name": "DISTRO_PATH",
                "value": "/common/wormhole/distro",
                "type": "str"
            },
            {
                "name": "DOCKER_PATH",
                "value": "/common/wormhole/docker",
                "type": "str"
            },
            {
                "name": "CIPHER",
                "value": "-aes-256-cbc",
                "type": "str"
            },
            {
                "name": "KEY_DERIVATION",
                "value": "-pbkdf2",
                "type": "str"
            },
            {
                "name": "CRYPTO_KEY",
                "value": "seed",
                "type": "str"
            },
            {
                "name": "MASTER_KEY",
                "value": "",
                "type": "str"
            },
            {
                "name": "LIVE_BRANCH",
                "value": "true",
                "type": "bool"
            },
            {
                "name": "POLL_RATE",
                "value": "30",
                "type": "num"
            }
        ]
    },
    {
        "id": "a2b11e533cc2dd7f",
        "type": "group",
        "z": "d833cbb1fb389561",
        "name": "",
        "style": {
            "stroke": "none",
            "label": true,
            "fill": "#777777",
            "fill-opacity": "0.35"
        },
        "nodes": [
            "057231d6ef4d8366",
            "b49434056d95c79c",
            "615fb6bab9daa7e9",
            "631eec0619a85844"
        ],
        "x": 3352,
        "y": 33,
        "w": 2680,
        "h": 1214
    },
    {
        "id": "a690a8bf99478aec",
        "type": "group",
        "z": "d833cbb1fb389561",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "9bc8b9beac76a597",
            "0cf42e8cf3873428",
            "88b50f78ac7ac388",
            "af0c8748b5728aeb",
            "96f59402be4449c0",
            "0fef0ba521329ee0",
            "7e0c63918dea4f8d"
        ],
        "x": 114,
        "y": 1459,
        "w": 1012,
        "h": 142
    },
    {
        "id": "514e2cdff3b4356f",
        "type": "group",
        "z": "d833cbb1fb389561",
        "name": "",
        "style": {
            "stroke": "none",
            "stroke-opacity": "0.68",
            "label": true,
            "fill": "#6f2fa0",
            "fill-opacity": "0.27"
        },
        "nodes": [
            "3b0042471cbe7fd7",
            "fd62441eb4cd73fb",
            "0c8967cc1f770401"
        ],
        "x": 108,
        "y": 59,
        "w": 3164,
        "h": 628
    },
    {
        "id": "0f4cc8f176bc5668",
        "type": "group",
        "z": "d833cbb1fb389561",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b8d69b49644f602b",
            "135913fd42947867",
            "15335a86c8cedfe5",
            "386a9383d1357ba6",
            "8daf87afc0bfa06f",
            "65847a45b179d321",
            "e5e29df88d87197b",
            "79349ccee8446b92"
        ],
        "x": 114,
        "y": 1279,
        "w": 1252,
        "h": 142
    },
    {
        "id": "9acd3d3c3a9231f5",
        "type": "group",
        "z": "d833cbb1fb389561",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1dd3fce061746689",
            "f9f23a667eec2bef",
            "007835a0fe153d6c",
            "db2b69a4571912e1",
            "697affa22022c413",
            "f4ccc25e05f9539a",
            "bfa23c42b5f8cdce",
            "5e5a16dc8af6066c",
            "24e8a6613bdc1269",
            "a03b9a3bb383a6c4",
            "45383a9d65be6b90",
            "97c348027b066797",
            "d2973f9cf3cbaa04",
            "d1f23f17fc46753d",
            "1e305cc28c97ed51",
            "525a912dd85ccc15",
            "d7deb632014c16e0",
            "6446d82aa78ee302",
            "057e4d3146f652ef",
            "bfb2eb9a8f8d6bfb",
            "579f3bcc2ad7f947",
            "91447b820a514fdb"
        ],
        "x": 114,
        "y": 959,
        "w": 2432,
        "h": 262
    },
    {
        "id": "8cb8be6fda32d7f8",
        "type": "group",
        "z": "d833cbb1fb389561",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c32b3d7bf023f58c",
            "263be701607f4465",
            "548b79897f77c384",
            "f0b886995ce8eda9",
            "30f59654bb183042",
            "64263072042a304f",
            "869449296c0bf517",
            "25f2e224cb872de0",
            "6fae41635b783d60",
            "fc5bfdb1b25ffad5",
            "444499a2c0837d4a",
            "679ba7b274e413f4",
            "1b5b295c7903573b",
            "ef99ccb8b9d6ea26",
            "4d38183bb1dbedfc",
            "79d8908c962ef4b9",
            "84d03fce791d5b49",
            "de20192127b61f00",
            "9415c27ffb9342b5",
            "79cbc02bef73c692",
            "f022f9622921dd1e",
            "d82f8a71917ec984",
            "528e5e6c34685a51",
            "1fa579e57119388b",
            "07eabca516013d9a",
            "8b6284ea168e187e",
            "7da362d67a6153a1",
            "fd6140741a737d4f"
        ],
        "x": 108,
        "y": 1733,
        "w": 5578,
        "h": 914
    },
    {
        "id": "05d3d4493bd6e175",
        "type": "group",
        "z": "d833cbb1fb389561",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "0719be1167dcab09",
            "a450ee77511a9278",
            "a9677b713bc5dec7",
            "c7bf8394ca306179"
        ],
        "x": 108,
        "y": 3339,
        "w": 3204,
        "h": 868
    },
    {
        "id": "f79da15299c44e67",
        "type": "group",
        "z": "d833cbb1fb389561",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "85daf6c5a5ba49f9",
            "89b44b76c3f4b136",
            "8b1ddbdf579d0148"
        ],
        "x": 108,
        "y": 2679,
        "w": 3184,
        "h": 548
    },
    {
        "id": "85daf6c5a5ba49f9",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "f79da15299c44e67",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b92a8e7df98ca244",
            "87b6166fc351c5ef",
            "8ccf717ad6732222",
            "c2bdbefc2360ade5",
            "f7ecafebbb7a2d15",
            "d34599f38ccaae1e",
            "0c5a67f8ba3c72c4",
            "b1b3c818c46a6cb7",
            "a9f64fc9ebff8f1f",
            "e94b9f241b089474",
            "173d1e4edcda0afc",
            "664b846630e77c64",
            "333bc8fab0c9bced",
            "a85df3d1da26646a"
        ],
        "x": 134,
        "y": 2759,
        "w": 2172,
        "h": 142
    },
    {
        "id": "89b44b76c3f4b136",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "f79da15299c44e67",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "452eaa09e00d510b",
            "168834e283360e38",
            "27e89bfe1a28b5df",
            "2202762b939eb710",
            "531060216aceab1d",
            "f37a48f647cb4354",
            "db20404b06a0d8a1",
            "5f6c16ce56c1303f",
            "3df2f31cd54080e1",
            "ad6b7ee0dd1b554f",
            "32eacc18d44e346c",
            "495d01d4969b4cd4",
            "803e36a7d55a083e",
            "1202c7c624299c6b",
            "2b92e76fd091ba5c",
            "f03543854cd9412e",
            "5a00517c7bc744f9",
            "3b7dad6007fe35dc",
            "a1df470a8b34f29c",
            "c05fdd0f5b3ad540",
            "67118d46b779cb9f",
            "19d80445556bad84",
            "c14ef887d3521d89",
            "1a1835751b88f522",
            "06dbb90b297295f0"
        ],
        "x": 134,
        "y": 2939,
        "w": 3132,
        "h": 262
    },
    {
        "id": "0719be1167dcab09",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "05d3d4493bd6e175",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "c66a7363208ed0aa",
            "8811e4c2212cd6de",
            "511a3388efc3752e",
            "4d423e51404c5ce7",
            "fe530fd495e81920",
            "64d85769ca82aa0b",
            "053f0a64585f0934",
            "77bfb086cc3a0767",
            "a54f5bd0b92f77aa",
            "48e8723b34471a75",
            "bf315b0d7e0f83c4",
            "044c33de463cdfd5",
            "fde527b76323bd22",
            "64265e641987b56e",
            "342a6c0141332d51",
            "ed2e6162ecdf50bb",
            "9f1c08909d59992c",
            "ecbf3831223e973b",
            "fb08b0419555d43f",
            "646c8f40d7c70790",
            "37369d41c7af3b58",
            "aa59e3c434587182"
        ],
        "x": 134,
        "y": 3679,
        "w": 2352,
        "h": 282
    },
    {
        "id": "a450ee77511a9278",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "05d3d4493bd6e175",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "735a447089049fdb",
            "606aaad183b26615",
            "eed837039afc2341",
            "04670c740af696de",
            "92770559c471d5b6",
            "eb33aef713845093",
            "01f1663e44b55a56",
            "46475f3ca0d7bc10",
            "676da4dad1aafec8",
            "353de0c67305eebc",
            "2282c41fa9caeefe",
            "d1254dbd048faa0c",
            "bb449f4e359e74bb",
            "1bd87310dc3e90b8",
            "d0b45e215185ca42",
            "399fc36dd99ae697",
            "683fbdd2d8ef9e62",
            "5321f9101cad2b07",
            "6706c3dec83a4825",
            "25050e739cd2aa6f",
            "d6241981f70622b9",
            "da7db72d1bffe3b3",
            "c2ade3e85dc8b69a",
            "12513aa838de8394",
            "1b250227e9637242",
            "b727c8af0418fe7e"
        ],
        "x": 134,
        "y": 3979,
        "w": 3152,
        "h": 202
    },
    {
        "id": "3b0042471cbe7fd7",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "514e2cdff3b4356f",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "86832fd00eb39555",
            "1761d5b2bbc644a5",
            "c4c15a1cdf6e4a64",
            "3692f921cc5d1f67",
            "b2425147da4afbb6",
            "cc8c172963d43aab",
            "d4352b5efb05281e",
            "0b6a21a6bcd35ddd",
            "931949772228bb41",
            "23f9a3da8af03092",
            "99091af6f67dd1d4",
            "4e7b730c0b689316",
            "25e3ca53bcee4c92",
            "c4ed381cebb49973"
        ],
        "x": 134,
        "y": 153,
        "w": 3112,
        "h": 248
    },
    {
        "id": "fd62441eb4cd73fb",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "514e2cdff3b4356f",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "75bfbd151cb71be0",
            "4f2d74514f487cb7",
            "86eb7c984ca1374a",
            "a42365dc5e69a307",
            "b1ed39f118eb8ec7",
            "de6a84f3340d1edb",
            "9a84cd758bbaa88a",
            "2d4c2ab3240345e6",
            "a70ae09dc924c81f",
            "3c5283adbcfaf9ba",
            "00129cd4ed39752f",
            "5799c807a88b452e",
            "81b3010232e0b277",
            "f2bd9e64bf86aa9a",
            "93355a554ce43c15",
            "c49c9a9bf248cacd",
            "1ab5349d52051faf",
            "3e16756ec3b8f3f4",
            "ab96b0018d41f681",
            "edc413a32a68dee9",
            "ad4cca8c23b2c48f",
            "713dd80fe0987e6d"
        ],
        "x": 134,
        "y": 439,
        "w": 2892,
        "h": 222
    },
    {
        "id": "631eec0619a85844",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "a2b11e533cc2dd7f",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "b11b2635def999bd",
            "319ce0ffbac317ca",
            "8ad0fafdd7428f4b",
            "f9b03f4ad3dcce84",
            "0f4c925ba90e86a1",
            "96c82a8483d78e01",
            "40feb89548d0ac77",
            "53177c3b91b5737a"
        ],
        "x": 3384,
        "y": 1019,
        "w": 802,
        "h": 202
    },
    {
        "id": "528e5e6c34685a51",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "1f7898041615f5db",
            "e2d73fbfc5ddb946",
            "9feca6181afa9a2d",
            "80fdcd06ca229e3b",
            "ef0fdff7d858f9ad"
        ],
        "x": 3654,
        "y": 2239,
        "w": 472,
        "h": 202
    },
    {
        "id": "b49434056d95c79c",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "a2b11e533cc2dd7f",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "7f6a8acb67150851",
            "cab748ab4f5e34b4",
            "1347ab3149bc4502",
            "02c37ccec76242fc",
            "3b04d8f3ed4fba72",
            "f948e65108a09f3d",
            "35cda9524bde7308"
        ],
        "x": 3378,
        "y": 59,
        "w": 1654,
        "h": 408
    },
    {
        "id": "057231d6ef4d8366",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "a2b11e533cc2dd7f",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "674bbd183da6c91c",
            "3abbba729be81d26",
            "400b7e5ae3dce9e9",
            "33aad57a10f3677a",
            "30c24ab3e79f2ee8",
            "9c77c7ce726b0475",
            "d508b774db7721f5",
            "8a36da90a15ae81a",
            "3cbf3fdf2a916d4b"
        ],
        "x": 3384,
        "y": 499,
        "w": 1082,
        "h": 142
    },
    {
        "id": "615fb6bab9daa7e9",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "a2b11e533cc2dd7f",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "991ba7c65f2313ca",
            "999c0b4b27f88f17",
            "e377729aac01d8f9",
            "9918b8bdc119fc71",
            "630bc9a5a168b928",
            "4774663de297ff9d",
            "f7f9a3c152a13150",
            "cbd9f71980f3423a",
            "57f33861f0c85b2d",
            "8f34017e9f1d878f",
            "e4b5873fa7d75f94",
            "6bbf57eb71d4880f",
            "9b0a437f500aad61",
            "9e8838fa009a9fd6",
            "2eca9639c066f299",
            "c19441d9fe1d018e",
            "56da62f6e2e4f61a",
            "2576dd407d654b28",
            "e4347c98def8efa8",
            "0a23db6f735b7d5d",
            "4ce0c02306a70c6e",
            "8d0bd1eaecde87f1",
            "73c897c68103b886"
        ],
        "x": 3381.4999389648438,
        "y": 650.2499885559082,
        "w": 2624.5000610351562,
        "h": 350.7500114440918
    },
    {
        "id": "1fa579e57119388b",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "9dd1bf57094ce932",
            "295e8becc5dd6358",
            "fe05d1754b7249df",
            "2422c2b34224c1bc",
            "dec76903b63ad372",
            "2299bde814cb1175",
            "e0f09e37cf082910",
            "bbec76e7362ffbf1",
            "fb21e4b5b7a346e3",
            "6877e4721b9348ed",
            "bb04efd252b5305f",
            "f0e33075871d5272",
            "ac327c2e241cbc81",
            "b291bbd79c3877b1",
            "67e4334603662e0e",
            "85bdd56e286045ce",
            "8a86a2781575684b",
            "7a888745d1c52d79",
            "bc26231443702782",
            "8828d925ea5f6648",
            "0d136ed41e20a413",
            "d21c46f6f3a0b4bf",
            "4b7b92309626c3e1",
            "8d5f9503206f073a",
            "8894723dfb154499",
            "c98e76a0d083ea12",
            "4a4feda0b441be99",
            "7b19ca4f2bdf34be"
        ],
        "x": 134,
        "y": 2299,
        "w": 1712,
        "h": 322
    },
    {
        "id": "07eabca516013d9a",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "63ddf517e9e81259",
            "bcbba35118da4437",
            "817c66cedc01eae7",
            "7937b805df8b2818",
            "88e02b79863ab489",
            "e80f8ab452100db2",
            "5792f799e3712f15",
            "f8d9afa0ae896e4b",
            "8b764bf7fc21b98d",
            "0ce9f0196068d49b",
            "f49765dd080e30d7",
            "e62ed44b5ee783b4",
            "7bb52c0fe9012bd7",
            "5e7a5b2d8894eb52",
            "c37815233555c44a",
            "93cc502dae657380",
            "29650d9b05857482",
            "0205ccfce90b03a4",
            "2abfe2a5acc11912",
            "6d0c0a5f452569d6",
            "21b4d9da8f0cdd84",
            "c02d77372b37e8eb",
            "db809be1b40dbb41",
            "27b3fb1d54afe1b0",
            "f98449288618ee58",
            "62ad60b8f4c84d7b",
            "5c6f76197acc8896",
            "9711434968a2f815",
            "587fdbfae8454a6c",
            "ca11aedaabe8fae2"
        ],
        "x": 134,
        "y": 1759,
        "w": 1572,
        "h": 522
    },
    {
        "id": "c7bf8394ca306179",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "05d3d4493bd6e175",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "3398d77e23e1794b",
            "57aa8f94105241f5",
            "3352df09b9a72534",
            "95e9276d0cd029f0",
            "966ff851cbd90656",
            "3513276384867acb",
            "36e3ce8a1cada8df",
            "84c35db7935f5bd2",
            "b3bf4d2f6e247252"
        ],
        "x": 134,
        "y": 3419,
        "w": 1092,
        "h": 202
    },
    {
        "id": "7da362d67a6153a1",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "be56b4a06b4e656d",
            "12ab915c6d542c9e",
            "3514b5af5a0e274d",
            "32149f8b483830b3",
            "5a64c488f44c911c",
            "f6271c2949347490",
            "2707c4c96813d262"
        ],
        "x": 2754,
        "y": 2154,
        "w": 752,
        "h": 207
    },
    {
        "id": "931949772228bb41",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "5429cc7d2931c78e",
            "2fabf0e87143da0d",
            "a033f0cb073bfeeb",
            "266f714180a2bd32",
            "bcf7eb8a7d4522f3",
            "19f1ca250d3146b5",
            "e35fc23af33c196c",
            "13da936a35087819",
            "4e2e459fd4f718e9",
            "843f33346d5c4e43",
            "f994870996316dfa"
        ],
        "x": 354,
        "y": 179,
        "w": 1232,
        "h": 162
    },
    {
        "id": "35cda9524bde7308",
        "type": "group",
        "z": "d833cbb1fb389561",
        "g": "b49434056d95c79c",
        "style": {
            "stroke": "#999999",
            "stroke-opacity": "1",
            "fill": "none",
            "fill-opacity": "1",
            "label": true,
            "label-position": "nw",
            "color": "#a4a4a4"
        },
        "nodes": [
            "98ebafed11752a6c",
            "c996930f97ac3b3e",
            "747aa1425987b15c",
            "66a79c84ad8fa333",
            "9e740ddbdd629a3f",
            "a549a7852731c409",
            "be37321c01603a49",
            "d7076b22d3a52674",
            "da49301b58a95f0d",
            "29e6b4cd946c37ef",
            "661e174eac0360af",
            "b17244c965e44e47"
        ],
        "x": 3404,
        "y": 219,
        "w": 1602,
        "h": 222
    },
    {
        "id": "e94b9f241b089474",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "x": 1580,
        "y": 2800,
        "wires": [
            [
                "87b6166fc351c5ef",
                "173d1e4edcda0afc"
            ]
        ]
    },
    {
        "id": "8ad0fafdd7428f4b",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "631eec0619a85844",
        "x": 3460,
        "y": 1120,
        "wires": [
            [
                "0f4c925ba90e86a1",
                "96c82a8483d78e01",
                "319ce0ffbac317ca"
            ]
        ]
    },
    {
        "id": "e4347c98def8efa8",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "x": 5280,
        "y": 840,
        "wires": [
            [
                "73c897c68103b886"
            ]
        ]
    },
    {
        "id": "21a0c062d73f39f0",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "x": 1000,
        "y": 5700,
        "wires": [
            [
                "d3021a3c310530ad"
            ]
        ]
    },
    {
        "id": "0380af892a3ce2e4",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "x": 880,
        "y": 5640,
        "wires": [
            [
                "21a0c062d73f39f0"
            ]
        ]
    },
    {
        "id": "9c77c7ce726b0475",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "057231d6ef4d8366",
        "x": 4380,
        "y": 600,
        "wires": [
            [
                "30c24ab3e79f2ee8"
            ]
        ]
    },
    {
        "id": "79d8908c962ef4b9",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "x": 2740,
        "y": 2460,
        "wires": [
            [
                "fd6140741a737d4f"
            ]
        ]
    },
    {
        "id": "84d03fce791d5b49",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "x": 4160,
        "y": 2460,
        "wires": [
            [
                "de20192127b61f00"
            ]
        ]
    },
    {
        "id": "f994870996316dfa",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "931949772228bb41",
        "x": 1120,
        "y": 300,
        "wires": [
            [
                "a033f0cb073bfeeb",
                "266f714180a2bd32"
            ]
        ]
    },
    {
        "id": "3e16756ec3b8f3f4",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "x": 380,
        "y": 520,
        "wires": [
            [
                "4f2d74514f487cb7",
                "c49c9a9bf248cacd"
            ]
        ]
    },
    {
        "id": "edc413a32a68dee9",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "x": 1360,
        "y": 620,
        "wires": [
            [
                "713dd80fe0987e6d"
            ]
        ]
    },
    {
        "id": "713dd80fe0987e6d",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "x": 1600,
        "y": 620,
        "wires": [
            [
                "1ab5349d52051faf"
            ]
        ]
    },
    {
        "id": "19d80445556bad84",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "x": 1660,
        "y": 3160,
        "wires": [
            [
                "1a1835751b88f522"
            ]
        ]
    },
    {
        "id": "342a6c0141332d51",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "x": 1880,
        "y": 3780,
        "wires": [
            [
                "a54f5bd0b92f77aa",
                "bf315b0d7e0f83c4"
            ]
        ]
    },
    {
        "id": "de20192127b61f00",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "x": 4340,
        "y": 2460,
        "wires": [
            [
                "679ba7b274e413f4"
            ]
        ]
    },
    {
        "id": "da7db72d1bffe3b3",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "x": 2880,
        "y": 4020,
        "wires": [
            [
                "eb33aef713845093",
                "46475f3ca0d7bc10"
            ]
        ]
    },
    {
        "id": "9415c27ffb9342b5",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "x": 4920,
        "y": 2580,
        "wires": [
            [
                "d82f8a71917ec984"
            ]
        ]
    },
    {
        "id": "79cbc02bef73c692",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "x": 2340,
        "y": 2260,
        "wires": [
            [
                "fc5bfdb1b25ffad5",
                "be56b4a06b4e656d"
            ]
        ]
    },
    {
        "id": "c98e76a0d083ea12",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "x": 1680,
        "y": 2580,
        "wires": [
            [
                "f022f9622921dd1e"
            ]
        ]
    },
    {
        "id": "f022f9622921dd1e",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "x": 4080,
        "y": 2580,
        "wires": [
            [
                "9415c27ffb9342b5",
                "1b5b295c7903573b"
            ]
        ]
    },
    {
        "id": "5e5a16dc8af6066c",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "x": 1160,
        "y": 1080,
        "wires": [
            [
                "a03b9a3bb383a6c4",
                "579f3bcc2ad7f947"
            ]
        ]
    },
    {
        "id": "0a23db6f735b7d5d",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "x": 3960,
        "y": 880,
        "wires": [
            [
                "991ba7c65f2313ca"
            ]
        ]
    },
    {
        "id": "d82f8a71917ec984",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "x": 5080,
        "y": 2280,
        "wires": [
            [
                "ef99ccb8b9d6ea26"
            ]
        ]
    },
    {
        "id": "c02d77372b37e8eb",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "x": 1680,
        "y": 1900,
        "wires": [
            [
                "548b79897f77c384"
            ]
        ]
    },
    {
        "id": "2707c4c96813d262",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "7da362d67a6153a1",
        "x": 3480,
        "y": 2180,
        "wires": [
            [
                "1f7898041615f5db"
            ]
        ]
    },
    {
        "id": "fd6140741a737d4f",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "x": 3520,
        "y": 2460,
        "wires": [
            [
                "84d03fce791d5b49"
            ]
        ]
    },
    {
        "id": "579f3bcc2ad7f947",
        "type": "junction",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "x": 1360,
        "y": 1080,
        "wires": [
            [
                "f4ccc25e05f9539a",
                "bfb2eb9a8f8d6bfb"
            ]
        ]
    },
    {
        "id": "b92a8e7df98ca244",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "name": "",
        "url": "/wh/get_config",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 250,
        "y": 2800,
        "wires": [
            [
                "8ccf717ad6732222",
                "a85df3d1da26646a"
            ]
        ]
    },
    {
        "id": "87b6166fc351c5ef",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "name": "200 success",
        "statusCode": "200",
        "headers": {},
        "x": 1950,
        "y": 2800,
        "wires": []
    },
    {
        "id": "b11b2635def999bd",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "631eec0619a85844",
        "name": "401 unauthorised",
        "statusCode": "401",
        "headers": {},
        "x": 4070,
        "y": 1180,
        "wires": []
    },
    {
        "id": "9bc8b9beac76a597",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "a690a8bf99478aec",
        "name": "",
        "url": "/wh/health",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 220,
        "y": 1500,
        "wires": [
            [
                "af0c8748b5728aeb",
                "7e0c63918dea4f8d"
            ]
        ]
    },
    {
        "id": "5429cc7d2931c78e",
        "type": "exec",
        "z": "d833cbb1fb389561",
        "g": "931949772228bb41",
        "command": "openssl rand -hex 16",
        "addpay": "",
        "append": "",
        "useSpawn": "false",
        "timer": "5",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 480,
        "y": 260,
        "wires": [
            [
                "bcf7eb8a7d4522f3"
            ],
            [
                "13da936a35087819"
            ],
            [
                "19f1ca250d3146b5"
            ]
        ]
    },
    {
        "id": "86832fd00eb39555",
        "type": "inject",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "name": "Add new API key",
        "props": [
            {
                "p": "payload"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 260,
        "y": 260,
        "wires": [
            [
                "5429cc7d2931c78e"
            ]
        ]
    },
    {
        "id": "2fabf0e87143da0d",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "931949772228bb41",
        "name": "stdout",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1290,
        "y": 220,
        "wires": []
    },
    {
        "id": "a033f0cb073bfeeb",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "931949772228bb41",
        "name": "return code",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1310,
        "y": 300,
        "wires": []
    },
    {
        "id": "266f714180a2bd32",
        "type": "join",
        "z": "d833cbb1fb389561",
        "g": "931949772228bb41",
        "name": "",
        "mode": "custom",
        "build": "object",
        "property": "payload",
        "propertyType": "msg",
        "key": "topic",
        "joiner": "\\n",
        "joinerType": "str",
        "useparts": false,
        "accumulate": false,
        "timeout": "",
        "count": "2",
        "reduceRight": false,
        "reduceExp": "",
        "reduceInit": "",
        "reduceInitType": "",
        "reduceFixup": "",
        "x": 1310,
        "y": 260,
        "wires": [
            [
                "4e2e459fd4f718e9"
            ]
        ]
    },
    {
        "id": "bcf7eb8a7d4522f3",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "931949772228bb41",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "stdout",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 710,
        "y": 220,
        "wires": [
            [
                "e35fc23af33c196c"
            ]
        ]
    },
    {
        "id": "19f1ca250d3146b5",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "931949772228bb41",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "return",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "payload.code",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 720,
        "y": 300,
        "wires": [
            [
                "f994870996316dfa"
            ]
        ]
    },
    {
        "id": "4e2e459fd4f718e9",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "931949772228bb41",
        "name": "success",
        "property": "payload.return",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 1500,
        "y": 260,
        "wires": [
            [
                "b2425147da4afbb6"
            ]
        ]
    },
    {
        "id": "1761d5b2bbc644a5",
        "type": "file in",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "name": "",
        "filename": "API_KEYS_PATH",
        "filenameType": "env",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1960,
        "y": 260,
        "wires": [
            [
                "23f9a3da8af03092"
            ]
        ]
    },
    {
        "id": "c4c15a1cdf6e4a64",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "name": "add_key",
        "func": "const user = \"default\";\n\nif (msg.payload == null){\n    msg.payload = new Object;\n}\nmsg.payload[msg.new_api_key] = user;\nmsg.new_user = user;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2260,
        "y": 260,
        "wires": [
            [
                "99091af6f67dd1d4"
            ]
        ]
    },
    {
        "id": "3692f921cc5d1f67",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "name": "Overflow",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 3120,
        "y": 300,
        "wires": []
    },
    {
        "id": "b2425147da4afbb6",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "new_api_key",
                "pt": "msg",
                "to": "payload.stdout",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1740,
        "y": 260,
        "wires": [
            [
                "1761d5b2bbc644a5"
            ]
        ]
    },
    {
        "id": "cc8c172963d43aab",
        "type": "file",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "name": "",
        "filename": "API_KEYS_PATH",
        "filenameType": "env",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 2900,
        "y": 240,
        "wires": [
            [
                "0b6a21a6bcd35ddd"
            ]
        ]
    },
    {
        "id": "d4352b5efb05281e",
        "type": "delay",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "name": "",
        "pauseType": "rate",
        "timeout": "3",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "3",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": true,
        "allowrate": false,
        "outputs": 2,
        "x": 2540,
        "y": 260,
        "wires": [
            [
                "cc8c172963d43aab",
                "c4ed381cebb49973"
            ],
            [
                "4e7b730c0b689316"
            ]
        ]
    },
    {
        "id": "e35fc23af33c196c",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "931949772228bb41",
        "name": "trimEnd",
        "func": "msg.payload = msg.payload.trimEnd();\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1100,
        "y": 220,
        "wires": [
            [
                "266f714180a2bd32",
                "2fabf0e87143da0d"
            ]
        ]
    },
    {
        "id": "991ba7c65f2313ca",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "req.headers.authorization",
        "property": "req.headers.authorization",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 4130,
        "y": 880,
        "wires": [
            [
                "57f33861f0c85b2d"
            ],
            [
                "9918b8bdc119fc71"
            ]
        ]
    },
    {
        "id": "319ce0ffbac317ca",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "631eec0619a85844",
        "name": "Declined authentication",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 3770,
        "y": 1120,
        "wires": []
    },
    {
        "id": "8ccf717ad6732222",
        "type": "delay",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "3",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 620,
        "y": 2800,
        "wires": [
            [
                "b1b3c818c46a6cb7"
            ]
        ]
    },
    {
        "id": "999c0b4b27f88f17",
        "type": "file in",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "read api_keys_path",
        "filename": "filename",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 4590,
        "y": 820,
        "wires": [
            [
                "cbd9f71980f3423a"
            ]
        ]
    },
    {
        "id": "e377729aac01d8f9",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "check auth",
        "func": "const token = msg.req.headers.authorization.replace('Bearer ', '');\n\nif (token in msg.payload){\n    msg.auth_success = true;\n    if (msg.auth_topic == \"rpi\"){\n        msg.auth_user = msg.payload[token]['config-name'];\n    }\n    else if (msg.auth_topic == \"user\"){\n        msg.auth_user = msg.payload[token];\n    }\n}\nelse{\n    msg.auth_success = false;\n    msg.auth_user = \"default\";\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4930,
        "y": 820,
        "wires": [
            [
                "8f34017e9f1d878f"
            ]
        ]
    },
    {
        "id": "c2bdbefc2360ade5",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 910,
        "y": 2800,
        "wires": [
            [
                "f7ecafebbb7a2d15"
            ],
            [
                "a9f64fc9ebff8f1f"
            ]
        ]
    },
    {
        "id": "f7ecafebbb7a2d15",
        "type": "file in",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "name": "",
        "filename": "CONFIGS_PATH",
        "filenameType": "env",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1120,
        "y": 2800,
        "wires": [
            [
                "d34599f38ccaae1e"
            ]
        ]
    },
    {
        "id": "d34599f38ccaae1e",
        "type": "yaml",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "property": "payload",
        "name": "",
        "x": 1310,
        "y": 2800,
        "wires": [
            [
                "0c5a67f8ba3c72c4"
            ]
        ]
    },
    {
        "id": "0c5a67f8ba3c72c4",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "name": "fetch user configs",
        "func": "msg.payload = msg.payload.users[msg.auth_user];\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1470,
        "y": 2800,
        "wires": [
            [
                "e94b9f241b089474"
            ]
        ]
    },
    {
        "id": "0b6a21a6bcd35ddd",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "name": "New key added",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 3120,
        "y": 240,
        "wires": []
    },
    {
        "id": "0cf42e8cf3873428",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "a690a8bf99478aec",
        "name": "Create Response",
        "func": "const timestamp = new Date().toISOString();\nmsg.payload = {\n    \"status\": \"healthy\",\n    \"timestamp\": timestamp\n};\n\nreturn msg;",
        "outputs": 1,
        "timeout": "",
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 1500,
        "wires": [
            [
                "88b50f78ac7ac388"
            ]
        ]
    },
    {
        "id": "88b50f78ac7ac388",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "a690a8bf99478aec",
        "name": "",
        "statusCode": "200",
        "headers": {
            "content-type": "application/json"
        },
        "x": 1000,
        "y": 1500,
        "wires": []
    },
    {
        "id": "af0c8748b5728aeb",
        "type": "delay",
        "z": "d833cbb1fb389561",
        "g": "a690a8bf99478aec",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "3",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 600,
        "y": 1500,
        "wires": [
            [
                "0cf42e8cf3873428",
                "0fef0ba521329ee0"
            ]
        ]
    },
    {
        "id": "75bfbd151cb71be0",
        "type": "inject",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "Encrypt passwords",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 270,
        "y": 520,
        "wires": [
            [
                "3e16756ec3b8f3f4"
            ]
        ]
    },
    {
        "id": "4f2d74514f487cb7",
        "type": "file in",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "",
        "filename": "CONFIGS_PATH",
        "filenameType": "env",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 540,
        "y": 520,
        "wires": [
            [
                "86eb7c984ca1374a"
            ]
        ]
    },
    {
        "id": "86eb7c984ca1374a",
        "type": "yaml",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "property": "payload",
        "name": "",
        "x": 730,
        "y": 520,
        "wires": [
            [
                "b1ed39f118eb8ec7"
            ]
        ]
    },
    {
        "id": "a42365dc5e69a307",
        "type": "exec",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "command": "",
        "addpay": "update.command",
        "append": "",
        "useSpawn": "false",
        "timer": "5",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 1310,
        "y": 520,
        "wires": [
            [
                "2d4c2ab3240345e6"
            ],
            [
                "93355a554ce43c15"
            ],
            [
                "de6a84f3340d1edb"
            ]
        ]
    },
    {
        "id": "b1ed39f118eb8ec7",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "set encryption parameters",
        "func": "const outputMsgs = [];\nconst cipher = env.get(\"CIPHER\");\nconst key_derivation = env.get(\"KEY_DERIVATION\");\nconst crypto_key = env.get(\"CRYPTO_KEY\");\n\nfor (const userKey in msg.payload.users) {\n    const user = msg.payload.users[userKey];\n    for (const config_id in user) {\n        const config = user[config_id];\n        if (config && typeof config === 'object') {\n            if (config.wifi) {\n                if (config.wifi.encrypted == false){\n                    const password = config.wifi.password;\n                    const path = `msg.payload.users.${userKey}.${config_id}.wifi`;\n                    let newMsg = new Object;\n                    newMsg.data = msg.payload;\n                    newMsg.update = { \n                        command: \"echo '\" + password + \"' | openssl enc \" + cipher + \" \" + key_derivation + \" -salt -pass pass:'\" + crypto_key + \"' | base64\",\n                        password: password, \n                        path: path\n                    } \n                    outputMsgs.push(newMsg);\n                }\n            }\n            if (config.ssh) {\n                if (config.ssh.encrypted == false){\n                    const password = config.ssh.password;\n                    const path = `msg.payload.users.${userKey}.${config_id}.ssh`;\n                    let newMsg = new Object;\n                    newMsg.data = msg.payload;\n                    newMsg.update = { \n                        command: \"echo '\" + password + \"' | openssl enc \" + cipher + \" \" + key_derivation + \" -salt -pass pass:'\" + crypto_key + \"' | base64\",\n                        password: password, \n                        path: path\n                    } \n                    outputMsgs.push(newMsg);\n                }\n            }\n        }\n    }\n}\n\nreturn [outputMsgs];",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 930,
        "y": 520,
        "wires": [
            [
                "f2bd9e64bf86aa9a",
                "ab96b0018d41f681"
            ]
        ]
    },
    {
        "id": "de6a84f3340d1edb",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "return code",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1470,
        "y": 560,
        "wires": []
    },
    {
        "id": "9a84cd758bbaa88a",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "update data",
        "func": "for (const userKey in msg.payload.users) {\n    const user = msg.payload.users[userKey];\n    for (const config_id in user) {\n        const config = user[config_id];\n        if (config && typeof config === 'object') {\n            if (config.wifi) {\n                const path = `msg.payload.users.${userKey}.${config_id}.wifi`;\n                if (path == msg.update.path){\n                    config.wifi.password = msg.update.encrypted_password;\n                    config.wifi.encrypted = true;\n                }\n            }\n            if (config.ssh) {\n                const path = `msg.payload.users.${userKey}.${config_id}.ssh`;\n                if (path == msg.update.path){\n                    config.ssh.password = msg.update.encrypted_password;\n                    config.ssh.encrypted = true;\n                }\n            }\n        }\n    }\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2090,
        "y": 480,
        "wires": [
            [
                "3c5283adbcfaf9ba"
            ]
        ]
    },
    {
        "id": "2d4c2ab3240345e6",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "encrypted password",
        "rules": [
            {
                "t": "set",
                "p": "update.encrypted_password",
                "pt": "msg",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1500,
        "y": 480,
        "wires": [
            [
                "5799c807a88b452e"
            ]
        ]
    },
    {
        "id": "a70ae09dc924c81f",
        "type": "file",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "",
        "filename": "CONFIGS_PATH",
        "filenameType": "env",
        "appendNewline": true,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 2440,
        "y": 480,
        "wires": [
            [
                "00129cd4ed39752f",
                "ad4cca8c23b2c48f"
            ]
        ]
    },
    {
        "id": "3c5283adbcfaf9ba",
        "type": "yaml",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "property": "payload",
        "name": "",
        "x": 2250,
        "y": 480,
        "wires": [
            [
                "a70ae09dc924c81f"
            ]
        ]
    },
    {
        "id": "00129cd4ed39752f",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "Password in database encrypted",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2730,
        "y": 480,
        "wires": []
    },
    {
        "id": "5799c807a88b452e",
        "type": "file in",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "",
        "filename": "CONFIGS_PATH",
        "filenameType": "env",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1740,
        "y": 480,
        "wires": [
            [
                "81b3010232e0b277"
            ]
        ]
    },
    {
        "id": "81b3010232e0b277",
        "type": "yaml",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "property": "payload",
        "name": "",
        "x": 1930,
        "y": 480,
        "wires": [
            [
                "9a84cd758bbaa88a"
            ]
        ]
    },
    {
        "id": "f2bd9e64bf86aa9a",
        "type": "delay",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "5",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1140,
        "y": 520,
        "wires": [
            [
                "a42365dc5e69a307"
            ]
        ]
    },
    {
        "id": "c32b3d7bf023f58c",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "",
        "statusCode": "200",
        "headers": {
            "content-type": "text/plain"
        },
        "x": 5600,
        "y": 2220,
        "wires": []
    },
    {
        "id": "263be701607f4465",
        "type": "file in",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "",
        "filename": "filepath_install_script",
        "filenameType": "msg",
        "format": "",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 5420,
        "y": 2220,
        "wires": [
            [
                "c32b3d7bf023f58c"
            ]
        ]
    },
    {
        "id": "9dd1bf57094ce932",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "url": "/wh/install",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 240,
        "y": 2380,
        "wires": [
            [
                "295e8becc5dd6358",
                "4a4feda0b441be99"
            ]
        ]
    },
    {
        "id": "9918b8bdc119fc71",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "auth_success false",
        "rules": [
            {
                "t": "set",
                "p": "auth_success",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 5090,
        "y": 880,
        "wires": [
            [
                "e4347c98def8efa8"
            ]
        ]
    },
    {
        "id": "630bc9a5a168b928",
        "type": "link in",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "Auth",
        "links": [],
        "x": 3435,
        "y": 760,
        "wires": [
            [
                "2576dd407d654b28"
            ]
        ]
    },
    {
        "id": "4774663de297ff9d",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "auth out",
        "mode": "return",
        "links": [],
        "x": 5645,
        "y": 840,
        "wires": []
    },
    {
        "id": "b1b3c818c46a6cb7",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "name": "",
        "links": [
            "630bc9a5a168b928"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 770,
        "y": 2800,
        "wires": [
            [
                "c2bdbefc2360ade5"
            ]
        ]
    },
    {
        "id": "295e8becc5dd6358",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "links": [
            "630bc9a5a168b928"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 630,
        "y": 2380,
        "wires": [
            [
                "fe05d1754b7249df"
            ]
        ]
    },
    {
        "id": "fe05d1754b7249df",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 770,
        "y": 2380,
        "wires": [
            [
                "85bdd56e286045ce"
            ],
            [
                "2422c2b34224c1bc"
            ]
        ]
    },
    {
        "id": "f9b03f4ad3dcce84",
        "type": "link in",
        "z": "d833cbb1fb389561",
        "g": "631eec0619a85844",
        "name": "decline auth",
        "links": [
            "a9f64fc9ebff8f1f",
            "2422c2b34224c1bc",
            "531060216aceab1d",
            "64d85769ca82aa0b",
            "eed837039afc2341",
            "8daf87afc0bfa06f",
            "007835a0fe153d6c",
            "7937b805df8b2818",
            "95e9276d0cd029f0"
        ],
        "x": 3425,
        "y": 1120,
        "wires": [
            [
                "8ad0fafdd7428f4b"
            ]
        ]
    },
    {
        "id": "a9f64fc9ebff8f1f",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "name": "link out 1",
        "mode": "link",
        "links": [
            "f9b03f4ad3dcce84"
        ],
        "x": 1035,
        "y": 2860,
        "wires": []
    },
    {
        "id": "2422c2b34224c1bc",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "link out 2",
        "mode": "link",
        "links": [
            "f9b03f4ad3dcce84"
        ],
        "x": 905,
        "y": 2420,
        "wires": []
    },
    {
        "id": "548b79897f77c384",
        "type": "exec",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 1990,
        "y": 2360,
        "wires": [
            [
                "30f59654bb183042"
            ],
            [
                "6fae41635b783d60"
            ],
            [
                "f0b886995ce8eda9"
            ]
        ]
    },
    {
        "id": "f0b886995ce8eda9",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "return code",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2170,
        "y": 2420,
        "wires": []
    },
    {
        "id": "dec76903b63ad372",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "set tar command",
        "func": "msg.payload = \"tar -cf \" + msg.filepath + \" -C \" + env.get(\"SCRIPTS_PATH\") + \" .\" + \" --exclude 'install.sh'\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1550,
        "y": 2360,
        "wires": [
            [
                "8894723dfb154499"
            ]
        ]
    },
    {
        "id": "30f59654bb183042",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "code",
        "property": "rc.code",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2150,
        "y": 2300,
        "wires": [
            [
                "79cbc02bef73c692"
            ],
            [
                "25f2e224cb872de0"
            ]
        ]
    },
    {
        "id": "f7f9a3c152a13150",
        "type": "comment",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "Check auth",
        "info": "",
        "x": 3477.4999389648438,
        "y": 691.2499885559082,
        "wires": []
    },
    {
        "id": "0c8967cc1f770401",
        "type": "comment",
        "z": "d833cbb1fb389561",
        "g": "514e2cdff3b4356f",
        "name": "Tools",
        "info": "# Tools",
        "x": 190,
        "y": 100,
        "wires": []
    },
    {
        "id": "1f7898041615f5db",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "528e5e6c34685a51",
        "name": "set sha command",
        "func": "msg.payload = \"sha256sum \" + msg.filepath + \" | awk '{print $1}'\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3770,
        "y": 2280,
        "wires": [
            [
                "e2d73fbfc5ddb946"
            ]
        ]
    },
    {
        "id": "e2d73fbfc5ddb946",
        "type": "exec",
        "z": "d833cbb1fb389561",
        "g": "528e5e6c34685a51",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 3850,
        "y": 2340,
        "wires": [
            [
                "80fdcd06ca229e3b"
            ],
            [
                "ef0fdff7d858f9ad"
            ],
            [
                "9feca6181afa9a2d"
            ]
        ]
    },
    {
        "id": "9feca6181afa9a2d",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "528e5e6c34685a51",
        "name": "return code",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 4010,
        "y": 2400,
        "wires": []
    },
    {
        "id": "64263072042a304f",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "out",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 4230,
        "y": 2400,
        "wires": []
    },
    {
        "id": "80fdcd06ca229e3b",
        "type": "file",
        "z": "d833cbb1fb389561",
        "g": "528e5e6c34685a51",
        "name": "",
        "filename": "filepath_sha",
        "filenameType": "msg",
        "appendNewline": false,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 4000,
        "y": 2280,
        "wires": [
            [
                "64263072042a304f",
                "444499a2c0837d4a",
                "d82f8a71917ec984"
            ]
        ]
    },
    {
        "id": "2299bde814cb1175",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "url": "/wh/install.sha256",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 260,
        "y": 2580,
        "wires": [
            [
                "e0f09e37cf082910",
                "4a4feda0b441be99"
            ]
        ]
    },
    {
        "id": "e0f09e37cf082910",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "get filepath",
        "func": "msg.filepath = env.get(\"DISTRO_PATH\") + \"/distro.tar\";\nmsg.filepath_sha = msg.filepath + \".sha256\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 2580,
        "wires": [
            [
                "bbec76e7362ffbf1"
            ]
        ]
    },
    {
        "id": "bbec76e7362ffbf1",
        "type": "file in",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "filename": "filepath_sha",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1160,
        "y": 2580,
        "wires": [
            [
                "6877e4721b9348ed"
            ]
        ]
    },
    {
        "id": "fb21e4b5b7a346e3",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "statusCode": "200",
        "headers": {
            "Content-Type": "text/plain"
        },
        "x": 1460,
        "y": 2580,
        "wires": []
    },
    {
        "id": "6877e4721b9348ed",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "trim",
        "func": "msg.payload = msg.payload.trim();\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 2580,
        "wires": [
            [
                "fb21e4b5b7a346e3"
            ]
        ]
    },
    {
        "id": "28d7bad9edc07c0d",
        "type": "websocket out",
        "z": "d833cbb1fb389561",
        "name": "",
        "server": "92a3b4c89af70947",
        "client": "",
        "x": 1130,
        "y": 5700,
        "wires": []
    },
    {
        "id": "d3021a3c310530ad",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "name": "ws/install_status websocket",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 1180,
        "y": 5660,
        "wires": []
    },
    {
        "id": "53bec9c63ee874c4",
        "type": "function",
        "z": "d833cbb1fb389561",
        "name": "___END___",
        "func": "msg.payload = \"___END___\\n\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 730,
        "y": 5720,
        "wires": [
            [
                "0380af892a3ce2e4"
            ]
        ]
    },
    {
        "id": "ff96ad995c92545a",
        "type": "inject",
        "z": "d833cbb1fb389561",
        "name": "",
        "props": [
            {
                "p": "payload"
            },
            {
                "p": "topic",
                "vt": "str"
            }
        ],
        "repeat": "",
        "crontab": "",
        "once": false,
        "onceDelay": 0.1,
        "topic": "",
        "payload": "",
        "payloadType": "date",
        "x": 560,
        "y": 5720,
        "wires": [
            [
                "53bec9c63ee874c4"
            ]
        ]
    },
    {
        "id": "9a4c96f945ff90a8",
        "type": "function",
        "z": "d833cbb1fb389561",
        "name": "line",
        "func": "msg.payload += \"line \\n\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 710,
        "y": 5640,
        "wires": [
            [
                "0380af892a3ce2e4"
            ]
        ]
    },
    {
        "id": "23f9a3da8af03092",
        "type": "yaml",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "property": "payload",
        "name": "",
        "x": 2130,
        "y": 260,
        "wires": [
            [
                "c4c15a1cdf6e4a64"
            ]
        ]
    },
    {
        "id": "99091af6f67dd1d4",
        "type": "yaml",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "property": "payload",
        "name": "",
        "x": 2390,
        "y": 260,
        "wires": [
            [
                "d4352b5efb05281e"
            ]
        ]
    },
    {
        "id": "cbd9f71980f3423a",
        "type": "yaml",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "property": "payload",
        "name": "",
        "x": 4770,
        "y": 820,
        "wires": [
            [
                "e377729aac01d8f9"
            ]
        ]
    },
    {
        "id": "452eaa09e00d510b",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "",
        "url": "/wh/upload_config",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 270,
        "y": 3040,
        "wires": [
            [
                "27e89bfe1a28b5df",
                "06dbb90b297295f0"
            ]
        ]
    },
    {
        "id": "168834e283360e38",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 2920,
        "y": 2980,
        "wires": []
    },
    {
        "id": "27e89bfe1a28b5df",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "",
        "links": [
            "630bc9a5a168b928"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 590,
        "y": 3040,
        "wires": [
            [
                "2202762b939eb710"
            ]
        ]
    },
    {
        "id": "2202762b939eb710",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 730,
        "y": 3040,
        "wires": [
            [
                "5f6c16ce56c1303f"
            ],
            [
                "531060216aceab1d"
            ]
        ]
    },
    {
        "id": "531060216aceab1d",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "link out 3",
        "mode": "link",
        "links": [
            "f9b03f4ad3dcce84"
        ],
        "x": 855,
        "y": 3100,
        "wires": []
    },
    {
        "id": "57f33861f0c85b2d",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "save_payload",
                "pt": "msg",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4360,
        "y": 820,
        "wires": [
            [
                "999c0b4b27f88f17"
            ]
        ]
    },
    {
        "id": "8f34017e9f1d878f",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "save_payload",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "save_payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 5100,
        "y": 820,
        "wires": [
            [
                "e4347c98def8efa8",
                "9b0a437f500aad61"
            ]
        ]
    },
    {
        "id": "f37a48f647cb4354",
        "type": "exec",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "command": "",
        "addpay": "command",
        "append": "",
        "useSpawn": "false",
        "timer": "5",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 1310,
        "y": 3040,
        "wires": [
            [
                "ad6b7ee0dd1b554f"
            ],
            [
                "c05fdd0f5b3ad540"
            ],
            [
                "3df2f31cd54080e1"
            ]
        ]
    },
    {
        "id": "db20404b06a0d8a1",
        "type": "delay",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "5",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 1160,
        "y": 3040,
        "wires": [
            [
                "f37a48f647cb4354"
            ]
        ]
    },
    {
        "id": "5f6c16ce56c1303f",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "set decrypt parameters",
        "func": "const cipher = env.get(\"CIPHER\");\nconst key_derivation = env.get(\"KEY_DERIVATION\");\nconst crypto_key = env.get(\"CRYPTO_KEY\");\n\n//msg.command = \"echo '\" + msg.payload + \"' | openssl enc \" + cipher + \" \" + key_derivation + \" -base64 -d -salt -pass pass:'seed'\";\nmsg.command = \"echo '\" + msg.payload + \"' | openssl enc \" + cipher + \" \" + key_derivation + \" -base64 -d -salt -pass pass:'\" + crypto_key + \"'\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 940,
        "y": 3040,
        "wires": [
            [
                "db20404b06a0d8a1",
                "67118d46b779cb9f"
            ]
        ]
    },
    {
        "id": "3df2f31cd54080e1",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "return code",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1490,
        "y": 3100,
        "wires": []
    },
    {
        "id": "ad6b7ee0dd1b554f",
        "type": "json",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "",
        "property": "payload",
        "action": "obj",
        "pretty": false,
        "x": 1470,
        "y": 2980,
        "wires": [
            [
                "32eacc18d44e346c"
            ]
        ]
    },
    {
        "id": "32eacc18d44e346c",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "sort config data",
        "func": "msg.config = new Object;\n\nlet new_key = msg.payload['hardware-api-key'];\nlet new_config_object = new Object;\nnew_config_object['install-user'] = msg.auth_user;\nnew_config_object['install-id'] = msg.payload['install-id'];\nnew_config_object['config-name'] = msg.payload['config-name'];\nnew_config_object['time-creation'] = parseInt(msg.payload['time-creation']);\nnew_config_object['hostname'] = msg.payload['hostname'];\nnew_config_object['ip-address'] = msg.payload['ip-address'];\nnew_config_object['domain'] = msg.payload['domain'];\nnew_config_object['wh-port'] = parseInt(msg.payload['wh-port']);\n\nmsg.config[new_key] = new_config_object;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1620,
        "y": 2980,
        "wires": [
            [
                "495d01d4969b4cd4"
            ]
        ]
    },
    {
        "id": "495d01d4969b4cd4",
        "type": "file in",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "",
        "filename": "DEVICES_PATH",
        "filenameType": "env",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1820,
        "y": 2980,
        "wires": [
            [
                "1202c7c624299c6b"
            ]
        ]
    },
    {
        "id": "803e36a7d55a083e",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "add device",
        "func": "if (msg.payload == null){\n    msg.payload = new Object;\n}\n\n// if (msg.payload.devices == null) {\n//     msg.payload.devices = new Object;\n// }\n\nconst hw_key = Object.keys(msg.config)[0];\n\nif (!(hw_key in msg.payload)){\n    msg.payload[hw_key] = msg.config[hw_key];\n    msg.status = \"Adding hardware key to device database - \" + msg.payload[hw_key]['config-name'];\n    msg.success = true;\n}\nelse{\n    msg.status = \"Attempting to add a hardware key that is already in the database\";\n    msg.success = true;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2150,
        "y": 2980,
        "wires": [
            [
                "2b92e76fd091ba5c"
            ]
        ]
    },
    {
        "id": "1202c7c624299c6b",
        "type": "yaml",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "property": "payload",
        "name": "",
        "x": 2010,
        "y": 2980,
        "wires": [
            [
                "803e36a7d55a083e"
            ]
        ]
    },
    {
        "id": "2b92e76fd091ba5c",
        "type": "yaml",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "property": "payload",
        "name": "",
        "x": 2290,
        "y": 2980,
        "wires": [
            [
                "f03543854cd9412e"
            ]
        ]
    },
    {
        "id": "f03543854cd9412e",
        "type": "file",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "",
        "filename": "DEVICES_PATH",
        "filenameType": "env",
        "appendNewline": false,
        "createDir": false,
        "overwriteFile": "true",
        "encoding": "none",
        "x": 2460,
        "y": 2980,
        "wires": [
            [
                "5a00517c7bc744f9",
                "3b7dad6007fe35dc",
                "c14ef887d3521d89"
            ]
        ]
    },
    {
        "id": "5a00517c7bc744f9",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "Device database updated",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2730,
        "y": 3040,
        "wires": []
    },
    {
        "id": "3b7dad6007fe35dc",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "set response payload",
        "func": "msg.payload = {\n    \"status\": msg.status,\n    \"success\": msg.success\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2720,
        "y": 2980,
        "wires": [
            [
                "168834e283360e38"
            ]
        ]
    },
    {
        "id": "0f4c925ba90e86a1",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "631eec0619a85844",
        "name": "set response payload",
        "func": "msg.payload = {\n    \"status\": \"invalid_token\",\n    \"success\": false\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3620,
        "y": 1180,
        "wires": [
            [
                "b11b2635def999bd"
            ]
        ]
    },
    {
        "id": "98ebafed11752a6c",
        "type": "link in",
        "z": "d833cbb1fb389561",
        "g": "35cda9524bde7308",
        "name": "Log message",
        "links": [],
        "x": 3445,
        "y": 320,
        "wires": [
            [
                "661e174eac0360af"
            ]
        ]
    },
    {
        "id": "c996930f97ac3b3e",
        "type": "comment",
        "z": "d833cbb1fb389561",
        "g": "35cda9524bde7308",
        "name": "logs messages to the main log file. takes any msg.payload and a string msg.topic",
        "info": "",
        "x": 3870,
        "y": 260,
        "wires": []
    },
    {
        "id": "674bbd183da6c91c",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "057231d6ef4d8366",
        "name": "req.headers.authorization",
        "property": "req.headers.authorization",
        "propertyType": "msg",
        "rules": [
            {
                "t": "nnull"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 3590,
        "y": 600,
        "wires": [
            [
                "8a36da90a15ae81a"
            ],
            [
                "400b7e5ae3dce9e9"
            ]
        ]
    },
    {
        "id": "3abbba729be81d26",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "057231d6ef4d8366",
        "name": "check auth",
        "func": "const token = msg.req.headers.authorization.replace('Bearer ', '');\nconst key = env.get(\"MASTER_KEY\");\n\nif (token == key){\n    msg.auth_success = true;\n    msg.auth_user = \"admin\";\n}\nelse{\n    msg.auth_success = false;\n    msg.auth_user = \"default\";\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4070,
        "y": 540,
        "wires": [
            [
                "3cbf3fdf2a916d4b"
            ]
        ]
    },
    {
        "id": "400b7e5ae3dce9e9",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "057231d6ef4d8366",
        "name": "auth_success false",
        "rules": [
            {
                "t": "set",
                "p": "auth_success",
                "pt": "msg",
                "to": "false",
                "tot": "bool"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3990,
        "y": 600,
        "wires": [
            [
                "9c77c7ce726b0475"
            ]
        ]
    },
    {
        "id": "33aad57a10f3677a",
        "type": "link in",
        "z": "d833cbb1fb389561",
        "g": "057231d6ef4d8366",
        "name": "Master Auth",
        "links": [],
        "x": 3425,
        "y": 600,
        "wires": [
            [
                "674bbd183da6c91c"
            ]
        ]
    },
    {
        "id": "30c24ab3e79f2ee8",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "057231d6ef4d8366",
        "name": "auth out",
        "mode": "return",
        "links": [],
        "x": 4425,
        "y": 600,
        "wires": []
    },
    {
        "id": "d508b774db7721f5",
        "type": "comment",
        "z": "d833cbb1fb389561",
        "g": "057231d6ef4d8366",
        "name": "Master Check auth",
        "info": "",
        "x": 3530,
        "y": 540,
        "wires": []
    },
    {
        "id": "8a36da90a15ae81a",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "057231d6ef4d8366",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "save_payload",
                "pt": "msg",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3860,
        "y": 540,
        "wires": [
            [
                "3abbba729be81d26"
            ]
        ]
    },
    {
        "id": "3cbf3fdf2a916d4b",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "057231d6ef4d8366",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "save_payload",
                "tot": "msg"
            },
            {
                "t": "delete",
                "p": "save_payload",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4240,
        "y": 540,
        "wires": [
            [
                "9c77c7ce726b0475"
            ]
        ]
    },
    {
        "id": "869449296c0bf517",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 4720,
        "y": 2460,
        "wires": [
            []
        ]
    },
    {
        "id": "25f2e224cb872de0",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "tar error",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "compression error",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "install error",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2520,
        "y": 2360,
        "wires": [
            [
                "79d8908c962ef4b9"
            ]
        ]
    },
    {
        "id": "6fae41635b783d60",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "tar error",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "install error",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2160,
        "y": 2360,
        "wires": [
            [
                "79d8908c962ef4b9"
            ]
        ]
    },
    {
        "id": "fc5bfdb1b25ffad5",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "log tar packing",
        "func": "let requester = \"\";\nif (msg.topic = \"install\"){\n    requester = \"client\"\n}\nelse if(msg.topic = \"rpi-update\"){\n    requester = \"device\"\n}\nmsg.payload = \"packed the distro for \" + requester + \" \" + msg.auth_user + \" at \" + msg.filepath;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2540,
        "y": 2300,
        "wires": [
            [
                "79d8908c962ef4b9"
            ]
        ]
    },
    {
        "id": "ef0fdff7d858f9ad",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "528e5e6c34685a51",
        "name": "tar error",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "install error",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4000,
        "y": 2340,
        "wires": [
            [
                "84d03fce791d5b49"
            ]
        ]
    },
    {
        "id": "444499a2c0837d4a",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "log sha calc",
        "func": "let requester = \"\";\nif (msg.topic = \"install\"){\n    requester = \"client\"\n}\nelse if(msg.topic = \"rpi-update\"){\n    requester = \"device\"\n}\nmsg.payload = \"checksum calculated for \" + requester + \" \" + msg.auth_user +\": \" + msg.payload.trim();\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4250,
        "y": 2340,
        "wires": [
            [
                "de20192127b61f00"
            ]
        ]
    },
    {
        "id": "747aa1425987b15c",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "35cda9524bde7308",
        "name": "link out 4",
        "mode": "return",
        "links": [],
        "x": 4965,
        "y": 320,
        "wires": []
    },
    {
        "id": "96f59402be4449c0",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "a690a8bf99478aec",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1020,
        "y": 1560,
        "wires": [
            []
        ]
    },
    {
        "id": "0fef0ba521329ee0",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "a690a8bf99478aec",
        "name": "Log health request",
        "func": "msg.topic = \"health\";\nmsg.payload = \"Recieved reqest from x-forwarded-for:\" + msg.req.headers[\"x-forwarded-for\"];\nmsg.payload += \" x-real-ip:\" + msg.req.headers[\"x-real-ip\"];\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 810,
        "y": 1560,
        "wires": [
            [
                "96f59402be4449c0"
            ]
        ]
    },
    {
        "id": "96c82a8483d78e01",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "631eec0619a85844",
        "name": "Log failed auth",
        "func": "msg.topic=\"server\";\nmsg.payload = \"Rejected auth \" + msg.req.headers.authorization;\nmsg.payload += \" x-forwarded-for:\" + msg.req.headers[\"x-forwarded-for\"];\nmsg.payload += \" x-real-ip:\" + msg.req.headers[\"x-real-ip\"];\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3600,
        "y": 1060,
        "wires": [
            [
                "53177c3b91b5737a"
            ]
        ]
    },
    {
        "id": "40feb89548d0ac77",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "631eec0619a85844",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 4080,
        "y": 1060,
        "wires": [
            []
        ]
    },
    {
        "id": "173d1e4edcda0afc",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "name": "Log served configs",
        "func": "msg.topic = \"install\";\nmsg.payload = \"sent configurations to the user \" + msg.auth_user;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1730,
        "y": 2860,
        "wires": [
            [
                "333bc8fab0c9bced"
            ]
        ]
    },
    {
        "id": "664b846630e77c64",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2200,
        "y": 2860,
        "wires": [
            []
        ]
    },
    {
        "id": "e4b5873fa7d75f94",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "Log auth",
        "func": "msg.topic=\"server\";\nmsg.payload = \"auth approved for \" + msg.auth_user + \" to \" + msg.req.url + \" from \" + msg.req.headers[\"x-real-ip\"];\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 5720,
        "y": 760,
        "wires": [
            [
                "6bbf57eb71d4880f"
            ]
        ]
    },
    {
        "id": "6bbf57eb71d4880f",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 5900,
        "y": 760,
        "wires": [
            []
        ]
    },
    {
        "id": "9b0a437f500aad61",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "auth_success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 1,
        "x": 5300,
        "y": 760,
        "wires": [
            [
                "9e8838fa009a9fd6"
            ]
        ]
    },
    {
        "id": "3b04d8f3ed4fba72",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "b49434056d95c79c",
        "name": "log API call",
        "func": "msg.topic = \"api\";\nmsg.payload = msg.req.method + \" \" + msg.req.url + \" \" + msg.req.headers[\"x-real-ip\"];\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3670,
        "y": 160,
        "wires": [
            [
                "cab748ab4f5e34b4"
            ]
        ]
    },
    {
        "id": "7f6a8acb67150851",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "b49434056d95c79c",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 4360,
        "y": 160,
        "wires": [
            [
                "1347ab3149bc4502"
            ]
        ]
    },
    {
        "id": "13da936a35087819",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "931949772228bb41",
        "name": "backend error",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "backend error",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 700,
        "y": 260,
        "wires": [
            [
                "843f33346d5c4e43"
            ]
        ]
    },
    {
        "id": "843f33346d5c4e43",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "931949772228bb41",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 900,
        "y": 260,
        "wires": [
            []
        ]
    },
    {
        "id": "93355a554ce43c15",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "backend error",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "backend error",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1480,
        "y": 520,
        "wires": [
            [
                "713dd80fe0987e6d"
            ]
        ]
    },
    {
        "id": "4e7b730c0b689316",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "name": "backend error",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "backend error",
                "tot": "str"
            },
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "too many requests",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2920,
        "y": 300,
        "wires": [
            [
                "3692f921cc5d1f67",
                "25e3ca53bcee4c92"
            ]
        ]
    },
    {
        "id": "25e3ca53bcee4c92",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 3140,
        "y": 360,
        "wires": [
            []
        ]
    },
    {
        "id": "c4ed381cebb49973",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "3b0042471cbe7fd7",
        "name": "Log new user",
        "func": "msg.topic = \"administration\";\nmsg.payload = \"new user added - \" + msg.new_user;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2780,
        "y": 360,
        "wires": [
            [
                "25e3ca53bcee4c92"
            ]
        ]
    },
    {
        "id": "c49c9a9bf248cacd",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "Log password encryption order",
        "func": "msg.topic = \"administration\";\nmsg.payload = \"password encryption ordered\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 570,
        "y": 620,
        "wires": [
            [
                "edc413a32a68dee9"
            ]
        ]
    },
    {
        "id": "1ab5349d52051faf",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2920,
        "y": 620,
        "wires": [
            []
        ]
    },
    {
        "id": "ab96b0018d41f681",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "Log password encryption queue",
        "func": "const parts = msg.update.path.split('.');\nconst user = parts[3];\nconst config = parts[4];\nconst service = parts[5];\n\nmsg.topic = \"administration\";\nmsg.payload = service + \" password encryption was queued for user \" + user + \" for \" + config + \" config\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1190,
        "y": 580,
        "wires": [
            [
                "edc413a32a68dee9"
            ]
        ]
    },
    {
        "id": "ad4cca8c23b2c48f",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "fd62441eb4cd73fb",
        "name": "Log password encryption DONE",
        "func": "const parts = msg.update.path.split('.');\nconst user = parts[3];\nconst config = parts[4];\nconst service = parts[5];\n\nmsg.topic = \"administration\";\nmsg.payload = service + \" password encryption DONE for user \" + user + \" for \" + config + \" config\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2710,
        "y": 560,
        "wires": [
            [
                "1ab5349d52051faf"
            ]
        ]
    },
    {
        "id": "a1df470a8b34f29c",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 3160,
        "y": 3160,
        "wires": [
            []
        ]
    },
    {
        "id": "c05fdd0f5b3ad540",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "backend error",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "backend error",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1500,
        "y": 3040,
        "wires": [
            [
                "19d80445556bad84"
            ]
        ]
    },
    {
        "id": "67118d46b779cb9f",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "Log recieved configs",
        "func": "const size = Buffer.byteLength(msg.payload, 'utf8');\n\nmsg.topic = \"install\";\nmsg.payload = \"recieved encrypted configuration from user \" + msg.auth_user + \" (\" + size + \" bytes)\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1180,
        "y": 3160,
        "wires": [
            [
                "19d80445556bad84"
            ]
        ]
    },
    {
        "id": "c14ef887d3521d89",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "Log decrypted configs",
        "func": "const hw_key = Object.keys(msg.config)[0];\nconst name = msg.config[hw_key]['config-name'];\n\nmsg.topic = \"install\";\nmsg.payload = \"decrypted a configuration \" + name + \" from user \" + msg.auth_user+\"\\n\";\n\nif (msg.success){\n    msg.payload += \"\\tsuccess: \" + msg.status;\n}\nelse{\n    msg.payload += \"\\terror: \" + msg.status;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2700,
        "y": 3100,
        "wires": [
            [
                "1a1835751b88f522"
            ]
        ]
    },
    {
        "id": "66a79c84ad8fa333",
        "type": "file",
        "z": "d833cbb1fb389561",
        "g": "35cda9524bde7308",
        "name": "append to log",
        "filename": "filename",
        "filenameType": "msg",
        "appendNewline": true,
        "createDir": true,
        "overwriteFile": "false",
        "encoding": "none",
        "x": 4500,
        "y": 320,
        "wires": [
            [
                "747aa1425987b15c",
                "d7076b22d3a52674"
            ]
        ]
    },
    {
        "id": "9e740ddbdd629a3f",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "35cda9524bde7308",
        "name": "Log",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "payload",
        "targetType": "msg",
        "statusVal": "",
        "statusType": "auto",
        "x": 4910,
        "y": 400,
        "wires": []
    },
    {
        "id": "a549a7852731c409",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "35cda9524bde7308",
        "name": "format log message",
        "func": "function formatLogTime(date) {\n    const year = date.getFullYear().toString().slice(-2);\n    const month = (date.getMonth() + 1).toString().padStart(2, '0');\n    const day = date.getDate().toString().padStart(2, '0');\n    const hours = date.getHours().toString().padStart(2, '0');\n    const minutes = date.getMinutes().toString().padStart(2, '0');\n    const seconds = date.getSeconds().toString().padStart(2, '0');\n\n    return `${year}/${month}/${day} ${hours}:${minutes}:${seconds}`;\n}\n\nfunction prepareLogPayload(topic, payload) {\n    let logTime = new Date(); // Default to current time\n\n    // Check if a timestamp property exists and is valid\n    if (msg.timestamp && typeof msg.timestamp !== 'undefined') {\n        const candidateTimestamp = new Date(msg.timestamp);\n        // Check if the timestamp is a valid Date object\n        if (candidateTimestamp instanceof Date && !isNaN(candidateTimestamp)) {\n            logTime = candidateTimestamp;\n        }\n    }\n\n    // Get the current time in a human-readable format\n    const timestamp = formatLogTime(logTime);\n\n    let logMessage = '';\n\n    // Handle different types of payloads gracefully\n    if (typeof payload === 'object' && payload !== null) {\n        // If the payload is an object, convert it to a JSON string for readability\n        try {\n            logMessage = JSON.stringify(payload);\n        } catch (e) {\n            // Fallback in case of circular references or other stringify errors\n            logMessage = `[Object] - Could not serialize object to JSON: ${e.message}`;\n        }\n    } else if (payload === null) {\n        // Handle null explicitly\n        logMessage = 'null';\n    } else if (typeof payload === 'undefined') {\n        // Handle undefined explicitly\n        logMessage = 'undefined';\n    } else {\n        // For all other types (string, number, boolean, etc.), convert to a string\n        logMessage = String(payload);\n    }\n\n    // Construct the final log message with timestamp and topic\n    return `[${timestamp}] [${topic}] ${logMessage}`;\n}\n\nmsg.payload = prepareLogPayload(msg.topic, msg.payload);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3930,
        "y": 320,
        "wires": [
            [
                "be37321c01603a49"
            ]
        ]
    },
    {
        "id": "be37321c01603a49",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "35cda9524bde7308",
        "name": "set log path",
        "func": "const default_path = env.get(\"LOG_DIR_PATH\") + \"/server.log\";\n\nif (!(msg.filename && typeof msg.filename !== 'undefined')) {\n    msg.filename = default_path;\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4130,
        "y": 320,
        "wires": [
            [
                "da49301b58a95f0d"
            ]
        ]
    },
    {
        "id": "c66a7363208ed0aa",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "",
        "url": "/wh/install_log_write",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 270,
        "y": 3800,
        "wires": [
            [
                "ed2e6162ecdf50bb",
                "646c8f40d7c70790"
            ]
        ]
    },
    {
        "id": "8811e4c2212cd6de",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "set custom log path",
        "func": "const user = msg.auth_user;\nmsg.filename = env.get(\"LOG_DIR_PATH\") + \"/install/\" + msg.install_id + \".log\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1530,
        "y": 3920,
        "wires": [
            [
                "044c33de463cdfd5"
            ]
        ]
    },
    {
        "id": "511a3388efc3752e",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2200,
        "y": 3920,
        "wires": [
            [
                "4d423e51404c5ce7"
            ]
        ]
    },
    {
        "id": "4d423e51404c5ce7",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "Install log",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2380,
        "y": 3920,
        "wires": []
    },
    {
        "id": "fe530fd495e81920",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 1070,
        "y": 3800,
        "wires": [
            [
                "77bfb086cc3a0767",
                "9f1c08909d59992c"
            ],
            [
                "64d85769ca82aa0b"
            ]
        ]
    },
    {
        "id": "64d85769ca82aa0b",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "link out 5",
        "mode": "link",
        "links": [
            "f9b03f4ad3dcce84"
        ],
        "x": 1215,
        "y": 3860,
        "wires": []
    },
    {
        "id": "053f0a64585f0934",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 2280,
        "y": 3760,
        "wires": []
    },
    {
        "id": "77bfb086cc3a0767",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "set response payload",
        "func": "const requiredFields = ['timestamp', 'hostname', 'user', 'message'];\n\nmsg.payload.success = true;\nmsg.payload.status = `Thanks`;\n\n// Check that all required fields are present\nfor (const field of requiredFields) {\n    if (!(field in msg.payload)) {\n        msg.payload.success = false;\n        msg.payload.status = `Missing required field '${field}'.`;\n        return msg;\n    }\n}\n\n// Validate that timestamp can be parsed to an integer\nlet clientTimestamp = Number(msg.payload.timestamp);\nif (!Number.isInteger(clientTimestamp)) {\n    msg.payload.success = false;\n    msg.payload.status = 'The \\'timestamp\\' field must be a valid integer.';\n    return msg;\n}\n\n// Validate that other arguments are non-empty strings\nconst stringFields = ['hostname', 'user', 'message'];\nfor (const field of stringFields) {\n    if (typeof msg.payload[field] !== 'string' || msg.payload[field].trim() === '') {\n        msg.payload.success = false;\n        msg.payload.status = `The '${field}' field must be a non-empty string.`;\n        return msg;\n    }\n}\n\nif (clientTimestamp < 1e12) {\n    clientTimestamp *= 1000;\n}\n\n// Count the difference between server and client timestamps\nconst serverTimestamp = Date.now();\nconst timeDifference = serverTimestamp - clientTimestamp;\nmsg.payload.ts = timeDifference;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1300,
        "y": 3800,
        "wires": [
            [
                "8811e4c2212cd6de",
                "fde527b76323bd22"
            ]
        ]
    },
    {
        "id": "cab748ab4f5e34b4",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "b49434056d95c79c",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "filename",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4020,
        "y": 160,
        "wires": [
            [
                "7f6a8acb67150851"
            ]
        ]
    },
    {
        "id": "9e8838fa009a9fd6",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "delete filename",
        "rules": [
            {
                "t": "delete",
                "p": "filename",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 5500,
        "y": 760,
        "wires": [
            [
                "e4b5873fa7d75f94"
            ]
        ]
    },
    {
        "id": "a54f5bd0b92f77aa",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "is success",
        "property": "payload.success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2030,
        "y": 3760,
        "wires": [
            [
                "053f0a64585f0934",
                "ecbf3831223e973b"
            ],
            [
                "48e8723b34471a75"
            ]
        ]
    },
    {
        "id": "48e8723b34471a75",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "",
        "statusCode": "201",
        "headers": {},
        "x": 2280,
        "y": 3800,
        "wires": []
    },
    {
        "id": "bf315b0d7e0f83c4",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "Data client",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2030,
        "y": 3820,
        "wires": []
    },
    {
        "id": "044c33de463cdfd5",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "format payload into log message",
        "func": "msg.topic = msg.payload.hostname;\nif (msg.payload.ts == null){\n    msg.unset=true;\n    msg.payload = \"[\" + msg.payload.user + \"] [\" + (msg.payload.ts/1000).toFixed(2) + \"s delay] WTF\" + msg.payload.message;    \n}\nelse{\n    msg.unset=false;\n    msg.payload = \"[\" + msg.payload.user + \"] [\" + (msg.payload.ts/1000).toFixed(2) + \"s delay] \" + msg.payload.message;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1770,
        "y": 3920,
        "wires": [
            [
                "37369d41c7af3b58"
            ]
        ]
    },
    {
        "id": "d7076b22d3a52674",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "35cda9524bde7308",
        "name": "form debug message",
        "func": "msg.payload = msg.filename + \":\" + msg.payload;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4720,
        "y": 400,
        "wires": [
            [
                "9e740ddbdd629a3f"
            ]
        ]
    },
    {
        "id": "fde527b76323bd22",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "filename",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.hostname",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.user",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.message",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "payload.timestamp",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1740,
        "y": 3780,
        "wires": [
            [
                "342a6c0141332d51"
            ]
        ]
    },
    {
        "id": "679ba7b274e413f4",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "filename",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 4500,
        "y": 2460,
        "wires": [
            [
                "869449296c0bf517"
            ]
        ]
    },
    {
        "id": "1a1835751b88f522",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "filename",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2940,
        "y": 3160,
        "wires": [
            [
                "a1df470a8b34f29c"
            ]
        ]
    },
    {
        "id": "333bc8fab0c9bced",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "filename",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1980,
        "y": 2860,
        "wires": [
            [
                "664b846630e77c64"
            ]
        ]
    },
    {
        "id": "64265e641987b56e",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "validate install_id",
        "func": "function validateBearerToken(authorizationHeader) {\n    // Check if the header exists and starts with \"Bearer \"\n    if (!authorizationHeader || !authorizationHeader.startsWith(\"Bearer \")) {\n        console.log(\"Validation failed: Header is missing or does not start with 'Bearer '.\");\n        return null;\n    }\n\n    // Strip the \"Bearer \" prefix and trim any extra whitespace\n    const token = authorizationHeader.substring(\"Bearer \".length).trim();\n\n    // Regular expression to check for the format:\n    // - Starts with one or more digits (number)\n    // - Followed by a hyphen\n    // - Followed by exactly three letters\n    // - Followed by a hyphen\n    // - Followed by one or more digits (number)\n    // - Followed by a hyphen\n    // - Followed by exactly six letters\n    // The `^` and `$` ensure the entire string matches the pattern.\n    const specificFormatRegex = /^\\d+-[a-zA-Z]{3}-\\d+-[a-zA-Z]{6}$/;\n\n    // If the token does not match the specific format, validation fails.\n    if (!specificFormatRegex.test(token)) {\n        console.log(\"Validation failed: Token does not match the required 'number-three letters-number-six letters' format.\");\n        return null;\n    }\n\n    // If all checks pass, return the valid token.\n    return token;\n}\n\nconst token = validateBearerToken(msg.req.headers.authorization);\n\nif (token != null){\n    msg.auth_success = true;\n}\nelse{\n    msg.auth_success = false;\n}\n\nmsg.install_id = token;\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 3800,
        "wires": [
            [
                "fe530fd495e81920"
            ]
        ]
    },
    {
        "id": "735a447089049fdb",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "",
        "url": "/wh/install_log_read",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 270,
        "y": 4060,
        "wires": [
            [
                "c2ade3e85dc8b69a",
                "b727c8af0418fe7e"
            ]
        ]
    },
    {
        "id": "f402b49c256e0eb7",
        "type": "function",
        "z": "d833cbb1fb389561",
        "name": "set custom log path",
        "func": "const user = msg.auth_user;\nmsg.filename = env.get(\"LOG_DIR_PATH\") + \"/install/\" + msg.install_id + \".log\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1050,
        "y": 5480,
        "wires": [
            [
                "861a9fc664c546c5"
            ]
        ]
    },
    {
        "id": "751617839e651ca2",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 1560,
        "y": 5480,
        "wires": [
            [
                "b59467543477d67a"
            ]
        ]
    },
    {
        "id": "b59467543477d67a",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "name": "Install log",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1740,
        "y": 5480,
        "wires": []
    },
    {
        "id": "606aaad183b26615",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 1070,
        "y": 4060,
        "wires": [
            [
                "92770559c471d5b6",
                "12513aa838de8394"
            ],
            [
                "eed837039afc2341"
            ]
        ]
    },
    {
        "id": "eed837039afc2341",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "link out 6",
        "mode": "link",
        "links": [
            "f9b03f4ad3dcce84"
        ],
        "x": 1215,
        "y": 4120,
        "wires": []
    },
    {
        "id": "04670c740af696de",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 3200,
        "y": 4020,
        "wires": []
    },
    {
        "id": "92770559c471d5b6",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "set response payload",
        "func": "const requiredFields = ['line'];\n\nmsg.payload.success = true;\nmsg.payload.status = `Here you go, line ${msg.payload.line}`;\n\n// Check that all required fields are present\nfor (const field of requiredFields) {\n    if (!(field in msg.payload)) {\n        msg.payload.success = false;\n        msg.payload.status = `Missing required field '${field}'.`;\n        return msg;\n    }\n}\n\n// Validate that timestamp can be parsed to an integer\nlet clientTimestamp = Number(msg.payload.timestamp);\nif (!Number.isInteger(clientTimestamp)) {\n    msg.payload.success = false;\n    msg.payload.status = 'The \\'timestamp\\' field must be a valid integer.';\n    return msg;\n}\n\n// Validate that line number can be parsed to an integer\nlet clientLineNumber = Number(msg.payload.line);\nif (!Number.isInteger(clientLineNumber)) {\n    msg.payload.success = false;\n    msg.payload.status = 'The \\'line\\' field must be a valid integer.';\n    return msg;\n}\n\n// Count the difference between server and client timestamps\nconst serverTimestamp = Date.now();\nconst timeDifference = serverTimestamp - clientTimestamp;\nmsg.payload.ts = timeDifference;\n\nmsg.payload.line = clientLineNumber;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1300,
        "y": 4060,
        "wires": [
            [
                "2282c41fa9caeefe"
            ]
        ]
    },
    {
        "id": "eb33aef713845093",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "is success",
        "property": "payload.success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2990,
        "y": 4020,
        "wires": [
            [
                "04670c740af696de"
            ],
            [
                "01f1663e44b55a56"
            ]
        ]
    },
    {
        "id": "01f1663e44b55a56",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "",
        "statusCode": "201",
        "headers": {},
        "x": 3200,
        "y": 4080,
        "wires": []
    },
    {
        "id": "46475f3ca0d7bc10",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "Data client",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2990,
        "y": 4080,
        "wires": []
    },
    {
        "id": "861a9fc664c546c5",
        "type": "function",
        "z": "d833cbb1fb389561",
        "name": "format payload into log message",
        "func": "msg.topic = msg.payload.hostname;\n\nmsg.payload = \"[\" + msg.payload.user + \"] [\" + (msg.payload.ts/1000).toFixed(2) + \"s delay] \" + msg.payload.message;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1290,
        "y": 5480,
        "wires": [
            [
                "751617839e651ca2"
            ]
        ]
    },
    {
        "id": "676da4dad1aafec8",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "filename",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "auth_success",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "install_id",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "command",
                "pt": "msg"
            },
            {
                "t": "delete",
                "p": "correlationData",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2760,
        "y": 4020,
        "wires": [
            [
                "da7db72d1bffe3b3"
            ]
        ]
    },
    {
        "id": "353de0c67305eebc",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "validate install_id",
        "func": "function validateBearerToken(authorizationHeader) {\n    // Check if the header exists and starts with \"Bearer \"\n    if (!authorizationHeader || !authorizationHeader.startsWith(\"Bearer \")) {\n        console.log(\"Validation failed: Header is missing or does not start with 'Bearer '.\");\n        return null;\n    }\n\n    // Strip the \"Bearer \" prefix and trim any extra whitespace\n    const token = authorizationHeader.substring(\"Bearer \".length).trim();\n\n    // Regular expression to check for the format:\n    // - Starts with one or more digits (number)\n    // - Followed by a hyphen\n    // - Followed by exactly three letters\n    // - Followed by a hyphen\n    // - Followed by one or more digits (number)\n    // - Followed by a hyphen\n    // - Followed by exactly six letters\n    // The `^` and `$` ensure the entire string matches the pattern.\n    const specificFormatRegex = /^\\d+-[a-zA-Z]{3}-\\d+-[a-zA-Z]{6}$/;\n\n    // If the token does not match the specific format, validation fails.\n    if (!specificFormatRegex.test(token)) {\n        console.log(\"Validation failed: Token does not match the required 'number-three letters-number-six letters' format.\");\n        return null;\n    }\n\n    // If all checks pass, return the valid token.\n    return token;\n}\n\nconst token = validateBearerToken(msg.req.headers.authorization);\n\nif (token != null){\n    msg.auth_success = true;\n}\nelse{\n    msg.auth_success = false;\n}\n\nmsg.install_id = token;\n\nreturn msg",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 890,
        "y": 4060,
        "wires": [
            [
                "606aaad183b26615"
            ]
        ]
    },
    {
        "id": "2282c41fa9caeefe",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "set read log path",
        "func": "const marker_wait=\"___ WAITING ___\"\n\nmsg.filename = env.get(\"LOG_DIR_PATH\") + \"/install/\" + msg.install_id + \".log\";\n\nmsg.command = `line_num=${msg.payload.line}; file_path=\"${msg.filename}\"; total_lines=$(wc -l < \"$file_path\" | tr -d ' '); if [ \"$line_num\" -le \"$total_lines\" ]; then tail -n \"+$line_num\" \"$file_path\" | head -n 1; else echo \"${marker_wait}\"; fi `;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1510,
        "y": 4060,
        "wires": [
            [
                "399fc36dd99ae697"
            ]
        ]
    },
    {
        "id": "d1254dbd048faa0c",
        "type": "exec",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "command": "",
        "addpay": "command",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 1850,
        "y": 4060,
        "wires": [
            [
                "1bd87310dc3e90b8"
            ],
            [
                "d0b45e215185ca42"
            ],
            [
                "bb449f4e359e74bb"
            ]
        ]
    },
    {
        "id": "bb449f4e359e74bb",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "return code",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2150,
        "y": 4140,
        "wires": []
    },
    {
        "id": "1bd87310dc3e90b8",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "code",
        "property": "rc.code",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1990,
        "y": 4020,
        "wires": [
            [
                "d6241981f70622b9"
            ],
            [
                "d0b45e215185ca42"
            ]
        ]
    },
    {
        "id": "d0b45e215185ca42",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "log error",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "log error",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2140,
        "y": 4080,
        "wires": [
            [
                "683fbdd2d8ef9e62"
            ]
        ]
    },
    {
        "id": "399fc36dd99ae697",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "data",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1690,
        "y": 4060,
        "wires": [
            [
                "d1254dbd048faa0c"
            ]
        ]
    },
    {
        "id": "683fbdd2d8ef9e62",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2320,
        "y": 4080,
        "wires": [
            [
                "5321f9101cad2b07"
            ]
        ]
    },
    {
        "id": "5321f9101cad2b07",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "Log read error",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2500,
        "y": 4080,
        "wires": []
    },
    {
        "id": "6706c3dec83a4825",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "data.line",
                "pt": "msg",
                "to": "payload",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2330,
        "y": 4020,
        "wires": [
            [
                "25050e739cd2aa6f"
            ]
        ]
    },
    {
        "id": "25050e739cd2aa6f",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "data",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 2540,
        "y": 4020,
        "wires": [
            [
                "676da4dad1aafec8"
            ]
        ]
    },
    {
        "id": "d6241981f70622b9",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "trim",
        "func": "function removeLogPrefixes(inputLine) {\n  const logLine=String(inputLine);\n  // Regular expression to match and capture the log prefixes.\n  // It looks for a sequence of bracketed strings and an optional\n  // \"[0.04s delay]\" prefix.\n  const prefixRegex = /^(\\[[^\\]]+\\]\\s+){2,3}(\\[\\d+\\.\\d+s\\s+delay\\]\\s+)?/;\n\n  // If the line matches the pattern, replace the prefixes with an empty string.\n  // The second and third captured groups are the specific prefixes we want to keep.\n  if (prefixRegex.test(logLine)) {\n    return logLine.replace(/^(\\[[^\\]]+\\])\\s+(\\[[^\\]]+\\])\\s+\\[[^\\]]+\\]\\s+\\[\\d+\\.\\d+s\\s+delay\\]\\s+/, '$1 $2 ');\n  }\n\n  // If the line doesn't match the pattern, return the original line.\n  return logLine;\n}\n\n\n// Markers\nconst marker_wait=\"___ WAITING ___\"\nconst marker_fin=\"___ FINISHED ___\"\n\nif (msg.payload.includes(marker_wait)){\n  msg.payload = marker_wait;\n  msg.data.status=\"Hold up a minute...\"\n  return msg\n}\nif (msg.payload.includes(marker_fin)){\n  msg.payload = marker_fin;\n  msg.data.status=\"Log finished\";\n  return msg\n}\n\nmsg.payload=String(msg.payload).trim();\nmsg.payload = removeLogPrefixes(msg.payload);\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2130,
        "y": 4020,
        "wires": [
            [
                "6706c3dec83a4825"
            ]
        ]
    },
    {
        "id": "b8d69b49644f602b",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "0f4cc8f176bc5668",
        "name": "",
        "url": "/wh/get_username",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 240,
        "y": 1320,
        "wires": [
            [
                "135913fd42947867",
                "79349ccee8446b92"
            ]
        ]
    },
    {
        "id": "135913fd42947867",
        "type": "delay",
        "z": "d833cbb1fb389561",
        "g": "0f4cc8f176bc5668",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "3",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": false,
        "outputs": 1,
        "x": 600,
        "y": 1320,
        "wires": [
            [
                "386a9383d1357ba6"
            ]
        ]
    },
    {
        "id": "15335a86c8cedfe5",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "0f4cc8f176bc5668",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 890,
        "y": 1320,
        "wires": [
            [
                "e5e29df88d87197b"
            ],
            [
                "8daf87afc0bfa06f"
            ]
        ]
    },
    {
        "id": "386a9383d1357ba6",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "0f4cc8f176bc5668",
        "name": "",
        "links": [
            "630bc9a5a168b928"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 750,
        "y": 1320,
        "wires": [
            [
                "15335a86c8cedfe5"
            ]
        ]
    },
    {
        "id": "8daf87afc0bfa06f",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "0f4cc8f176bc5668",
        "name": "link out 7",
        "mode": "link",
        "links": [
            "f9b03f4ad3dcce84"
        ],
        "x": 1015,
        "y": 1380,
        "wires": []
    },
    {
        "id": "65847a45b179d321",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "0f4cc8f176bc5668",
        "name": "",
        "statusCode": "200",
        "headers": {
            "content-type": "text/plain"
        },
        "x": 1280,
        "y": 1320,
        "wires": []
    },
    {
        "id": "e5e29df88d87197b",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "0f4cc8f176bc5668",
        "name": "set username",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "auth_user",
                "tot": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1110,
        "y": 1320,
        "wires": [
            [
                "65847a45b179d321"
            ]
        ]
    },
    {
        "id": "53177c3b91b5737a",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "631eec0619a85844",
        "name": "",
        "rules": [
            {
                "t": "delete",
                "p": "filename",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3860,
        "y": 1060,
        "wires": [
            [
                "40feb89548d0ac77"
            ]
        ]
    },
    {
        "id": "bb04efd252b5305f",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "url": "/wh/install.distro",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 260,
        "y": 2520,
        "wires": [
            [
                "8a86a2781575684b",
                "4a4feda0b441be99"
            ]
        ]
    },
    {
        "id": "f0e33075871d5272",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "get filepath",
        "func": "msg.filepath = env.get(\"DISTRO_PATH\") + \"/distro.tar.enc\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 2520,
        "wires": [
            [
                "ac327c2e241cbc81"
            ]
        ]
    },
    {
        "id": "ac327c2e241cbc81",
        "type": "file in",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "filename": "filepath",
        "filenameType": "msg",
        "format": "",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1160,
        "y": 2520,
        "wires": [
            [
                "b291bbd79c3877b1"
            ]
        ]
    },
    {
        "id": "b291bbd79c3877b1",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "statusCode": "200",
        "headers": {
            "Content-Type": "application/octet-stream"
        },
        "x": 1460,
        "y": 2520,
        "wires": []
    },
    {
        "id": "67e4334603662e0e",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "LIVE_BRANCH true",
        "property": "LIVE_BRANCH",
        "propertyType": "env",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 1320,
        "y": 2380,
        "wires": [
            [
                "dec76903b63ad372"
            ],
            [
                "c98e76a0d083ea12"
            ]
        ]
    },
    {
        "id": "85bdd56e286045ce",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "get filepath",
        "func": "msg.filepath = env.get(\"DISTRO_PATH\") + \"/distro.tar\";\nmsg.filepath_sha = msg.filepath + \".sha256\";\nmsg.filepath_install_script = env.get(\"SCRIPTS_PATH\") + \"/install.sh\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1070,
        "y": 2380,
        "wires": [
            [
                "67e4334603662e0e"
            ]
        ]
    },
    {
        "id": "1b5b295c7903573b",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "log tar packing",
        "func": "let requester = \"\";\nif (msg.topic = \"install\"){\n    requester = \"client\"\n}\nelse if(msg.topic = \"rpi-update\"){\n    requester = \"device\"\n}\nmsg.payload = \"sending previously packed distro to \" + requester + \" \" + msg.auth_user;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 4240,
        "y": 2520,
        "wires": [
            [
                "679ba7b274e413f4"
            ]
        ]
    },
    {
        "id": "8a86a2781575684b",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "links": [
            "630bc9a5a168b928"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 630,
        "y": 2520,
        "wires": [
            [
                "7a888745d1c52d79"
            ]
        ]
    },
    {
        "id": "7a888745d1c52d79",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 770,
        "y": 2520,
        "wires": [
            [
                "f0e33075871d5272"
            ],
            [
                "2422c2b34224c1bc"
            ]
        ]
    },
    {
        "id": "bc26231443702782",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "url": "/wh/install.update",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 260,
        "y": 2480,
        "wires": [
            [
                "4b7b92309626c3e1",
                "4a4feda0b441be99"
            ]
        ]
    },
    {
        "id": "8828d925ea5f6648",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "get filepath",
        "func": "msg.filepath = env.get(\"SCRIPTS_PATH\")+\"/update.sh\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 990,
        "y": 2480,
        "wires": [
            [
                "0d136ed41e20a413"
            ]
        ]
    },
    {
        "id": "0d136ed41e20a413",
        "type": "file in",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "filename": "filepath",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1160,
        "y": 2480,
        "wires": [
            [
                "d21c46f6f3a0b4bf"
            ]
        ]
    },
    {
        "id": "d21c46f6f3a0b4bf",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "statusCode": "200",
        "headers": {
            "content-type": "text/plain"
        },
        "x": 1460,
        "y": 2480,
        "wires": []
    },
    {
        "id": "4b7b92309626c3e1",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "links": [
            "630bc9a5a168b928"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 630,
        "y": 2480,
        "wires": [
            [
                "8d5f9503206f073a"
            ]
        ]
    },
    {
        "id": "8d5f9503206f073a",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 770,
        "y": 2480,
        "wires": [
            [
                "8828d925ea5f6648"
            ],
            []
        ]
    },
    {
        "id": "1dd3fce061746689",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "",
        "url": "/wh/log",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 210,
        "y": 1080,
        "wires": [
            [
                "24e8a6613bdc1269"
            ]
        ]
    },
    {
        "id": "f9f23a667eec2bef",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 650,
        "y": 1080,
        "wires": [
            [
                "697affa22022c413"
            ],
            [
                "007835a0fe153d6c"
            ]
        ]
    },
    {
        "id": "007835a0fe153d6c",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "link out 8",
        "mode": "link",
        "links": [
            "f9b03f4ad3dcce84"
        ],
        "x": 785,
        "y": 1120,
        "wires": []
    },
    {
        "id": "db2b69a4571912e1",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "",
        "statusCode": "200",
        "headers": {},
        "x": 1740,
        "y": 1080,
        "wires": []
    },
    {
        "id": "697affa22022c413",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "set response payload",
        "func": "const requiredFields = ['timestamp', 'message'];\n\nmsg.payload.success = true;\nmsg.payload.status = `Thanks`;\n\n// Check that all required fields are present\nfor (const field of requiredFields) {\n    if (!(field in msg.payload)) {\n        msg.payload.success = false;\n        msg.payload.status = `Missing required field '${field}'.`;\n        return msg;\n    }\n}\n\n// Validate that timestamp can be parsed to an integer\nlet clientTimestamp = Number(msg.payload.timestamp);\nif (!Number.isInteger(clientTimestamp)) {\n    msg.payload.success = false;\n    msg.payload.status = 'The \\'timestamp\\' field must be a valid integer.';\n    return msg;\n}\n\n// Validate that other arguments are non-empty strings\nconst stringFields = ['message'];\nfor (const field of stringFields) {\n    if (typeof msg.payload[field] !== 'string' || msg.payload[field].trim() === '') {\n        msg.payload.success = false;\n        msg.payload.status = `The '${field}' field must be a non-empty string.`;\n        return msg;\n    }\n}\n\nif (clientTimestamp < 1e12) {\n    clientTimestamp *= 1000;\n}\n\n// Count the difference between server and client timestamps\nconst serverTimestamp = Date.now();\nconst timeDifference = serverTimestamp - clientTimestamp;\nmsg.payload.ts = timeDifference;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 880,
        "y": 1080,
        "wires": [
            [
                "5e5a16dc8af6066c"
            ]
        ]
    },
    {
        "id": "f4ccc25e05f9539a",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "is success",
        "property": "payload.success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1530,
        "y": 1080,
        "wires": [
            [
                "db2b69a4571912e1"
            ],
            [
                "bfa23c42b5f8cdce"
            ]
        ]
    },
    {
        "id": "bfa23c42b5f8cdce",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "",
        "statusCode": "201",
        "headers": {},
        "x": 1740,
        "y": 1140,
        "wires": []
    },
    {
        "id": "63ddf517e9e81259",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "url": "/wh/rpi.update",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 250,
        "y": 1960,
        "wires": [
            [
                "5e7a5b2d8894eb52",
                "21b4d9da8f0cdd84"
            ]
        ]
    },
    {
        "id": "2eca9639c066f299",
        "type": "link in",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "RPi Auth",
        "links": [],
        "x": 3435,
        "y": 960,
        "wires": [
            [
                "56da62f6e2e4f61a"
            ]
        ]
    },
    {
        "id": "c19441d9fe1d018e",
        "type": "comment",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "Check RPi auth",
        "info": "",
        "x": 3487.4999389648438,
        "y": 891.2499885559082,
        "wires": []
    },
    {
        "id": "56da62f6e2e4f61a",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "auth_topic rpi",
        "rules": [
            {
                "t": "set",
                "p": "auth_topic",
                "pt": "msg",
                "to": "rpi",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3580,
        "y": 960,
        "wires": [
            [
                "8d0bd1eaecde87f1"
            ]
        ]
    },
    {
        "id": "2576dd407d654b28",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "auth_topic user",
        "rules": [
            {
                "t": "set",
                "p": "auth_topic",
                "pt": "msg",
                "to": "user",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3580,
        "y": 760,
        "wires": [
            [
                "4ce0c02306a70c6e"
            ]
        ]
    },
    {
        "id": "4ce0c02306a70c6e",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "API_KEYS_PATH",
        "rules": [
            {
                "t": "set",
                "p": "filename",
                "pt": "msg",
                "to": "API_KEYS_PATH",
                "tot": "env"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3790,
        "y": 760,
        "wires": [
            [
                "0a23db6f735b7d5d"
            ]
        ]
    },
    {
        "id": "8d0bd1eaecde87f1",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "DEVICES_PATH",
        "rules": [
            {
                "t": "set",
                "p": "filename",
                "pt": "msg",
                "to": "DEVICES_PATH",
                "tot": "env"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3790,
        "y": 960,
        "wires": [
            [
                "0a23db6f735b7d5d"
            ]
        ]
    },
    {
        "id": "bcbba35118da4437",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "links": [
            "2eca9639c066f299"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 720,
        "y": 1900,
        "wires": [
            [
                "817c66cedc01eae7"
            ]
        ]
    },
    {
        "id": "817c66cedc01eae7",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 890,
        "y": 1900,
        "wires": [
            [
                "6d0c0a5f452569d6"
            ],
            [
                "7937b805df8b2818"
            ]
        ]
    },
    {
        "id": "7937b805df8b2818",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "link out 9",
        "mode": "link",
        "links": [
            "f9b03f4ad3dcce84"
        ],
        "x": 1055,
        "y": 1940,
        "wires": []
    },
    {
        "id": "88e02b79863ab489",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "get filepath",
        "func": "msg.filepath = env.get(\"DISTRO_PATH\") + \"/rpi_update.tar\";\nmsg.filepath_sha = msg.filepath + \".sha256\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 1960,
        "wires": [
            [
                "e80f8ab452100db2"
            ]
        ]
    },
    {
        "id": "e80f8ab452100db2",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "set tar command",
        "func": "msg.payload = \"tar -cf \" + msg.filepath + \" -C \" + env.get(\"SCRIPTS_PATH\") + \" ./rpi ./common\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1510,
        "y": 1960,
        "wires": [
            [
                "c02d77372b37e8eb"
            ]
        ]
    },
    {
        "id": "8894723dfb154499",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "topic install",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "install",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 1750,
        "y": 2360,
        "wires": [
            [
                "548b79897f77c384"
            ]
        ]
    },
    {
        "id": "ef99ccb8b9d6ea26",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "is topic \"install\"",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "install",
                "vt": "str"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 5220,
        "y": 2280,
        "wires": [
            [
                "263be701607f4465"
            ],
            [
                "4d38183bb1dbedfc"
            ]
        ]
    },
    {
        "id": "4d38183bb1dbedfc",
        "type": "file in",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "",
        "filename": "filepath_enc",
        "filenameType": "msg",
        "format": "",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 5420,
        "y": 2280,
        "wires": [
            [
                "8b6284ea168e187e"
            ]
        ]
    },
    {
        "id": "e62ed44b5ee783b4",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "statusCode": "200",
        "headers": {
            "Content-Type": "text/plain"
        },
        "x": 1540,
        "y": 2180,
        "wires": []
    },
    {
        "id": "7bb52c0fe9012bd7",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "trim",
        "func": "msg.payload = msg.payload.trim();\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1390,
        "y": 2180,
        "wires": [
            [
                "e62ed44b5ee783b4"
            ]
        ]
    },
    {
        "id": "f49765dd080e30d7",
        "type": "file in",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "filename": "filepath_sha",
        "filenameType": "msg",
        "format": "utf8",
        "chunk": false,
        "sendError": false,
        "encoding": "none",
        "allProps": false,
        "x": 1240,
        "y": 2180,
        "wires": [
            [
                "7bb52c0fe9012bd7"
            ]
        ]
    },
    {
        "id": "f8d9afa0ae896e4b",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "get filepath",
        "func": "msg.filepath = env.get(\"DISTRO_PATH\") + \"/rpi_update.tar\";\nmsg.filepath_sha = msg.filepath + \".sha256\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 2240,
        "wires": [
            [
                "f49765dd080e30d7"
            ]
        ]
    },
    {
        "id": "5792f799e3712f15",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "url": "/wh/rpi.update.sha256",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 270,
        "y": 2240,
        "wires": [
            [
                "f8d9afa0ae896e4b",
                "8b764bf7fc21b98d"
            ]
        ]
    },
    {
        "id": "02c37ccec76242fc",
        "type": "link in",
        "z": "d833cbb1fb389561",
        "g": "b49434056d95c79c",
        "name": "Log API call",
        "links": [],
        "x": 3455,
        "y": 160,
        "wires": [
            [
                "3b04d8f3ed4fba72"
            ]
        ]
    },
    {
        "id": "1347ab3149bc4502",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "b49434056d95c79c",
        "name": "Log API call out",
        "mode": "return",
        "links": [],
        "x": 4595,
        "y": 160,
        "wires": []
    },
    {
        "id": "79349ccee8446b92",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "0f4cc8f176bc5668",
        "name": "",
        "links": [
            "02c37ccec76242fc"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 590,
        "y": 1380,
        "wires": [
            []
        ]
    },
    {
        "id": "7e0c63918dea4f8d",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "a690a8bf99478aec",
        "name": "",
        "links": [
            "02c37ccec76242fc"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 590,
        "y": 1560,
        "wires": [
            []
        ]
    },
    {
        "id": "8b764bf7fc21b98d",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "links": [
            "02c37ccec76242fc"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 2140,
        "wires": [
            []
        ]
    },
    {
        "id": "4a4feda0b441be99",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "",
        "links": [
            "02c37ccec76242fc"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 510,
        "y": 2440,
        "wires": [
            []
        ]
    },
    {
        "id": "a85df3d1da26646a",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "85daf6c5a5ba49f9",
        "name": "",
        "links": [
            "02c37ccec76242fc"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 610,
        "y": 2860,
        "wires": [
            []
        ]
    },
    {
        "id": "06dbb90b297295f0",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "89b44b76c3f4b136",
        "name": "",
        "links": [
            "02c37ccec76242fc"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 610,
        "y": 3100,
        "wires": [
            []
        ]
    },
    {
        "id": "ed2e6162ecdf50bb",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "",
        "links": [
            "02c37ccec76242fc"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 3860,
        "wires": [
            []
        ]
    },
    {
        "id": "c2ade3e85dc8b69a",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "",
        "links": [
            "02c37ccec76242fc"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 4120,
        "wires": [
            []
        ]
    },
    {
        "id": "a9677b713bc5dec7",
        "type": "comment",
        "z": "d833cbb1fb389561",
        "g": "05d3d4493bd6e175",
        "name": "Common endpoints",
        "info": "",
        "x": 230,
        "y": 3380,
        "wires": []
    },
    {
        "id": "8b1ddbdf579d0148",
        "type": "comment",
        "z": "d833cbb1fb389561",
        "g": "f79da15299c44e67",
        "name": "Client endpoints",
        "info": "",
        "x": 220,
        "y": 2720,
        "wires": []
    },
    {
        "id": "7b19ca4f2bdf34be",
        "type": "comment",
        "z": "d833cbb1fb389561",
        "g": "1fa579e57119388b",
        "name": "Client endpoints",
        "info": "",
        "x": 240,
        "y": 2340,
        "wires": []
    },
    {
        "id": "0ce9f0196068d49b",
        "type": "comment",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "RPi endpoints",
        "info": "",
        "x": 230,
        "y": 1800,
        "wires": []
    },
    {
        "id": "da49301b58a95f0d",
        "type": "delay",
        "z": "d833cbb1fb389561",
        "g": "35cda9524bde7308",
        "name": "",
        "pauseType": "rate",
        "timeout": "200",
        "timeoutUnits": "milliseconds",
        "rate": "10",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": true,
        "outputs": 1,
        "x": 4320,
        "y": 320,
        "wires": [
            [
                "66a79c84ad8fa333"
            ]
        ]
    },
    {
        "id": "29e6b4cd946c37ef",
        "type": "comment",
        "z": "d833cbb1fb389561",
        "g": "35cda9524bde7308",
        "name": "Log message",
        "info": "",
        "x": 3500,
        "y": 260,
        "wires": []
    },
    {
        "id": "f948e65108a09f3d",
        "type": "comment",
        "z": "d833cbb1fb389561",
        "g": "b49434056d95c79c",
        "name": "Log API call",
        "info": "",
        "x": 3490,
        "y": 100,
        "wires": []
    },
    {
        "id": "12513aa838de8394",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "install_log_read request",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1310,
        "y": 4020,
        "wires": []
    },
    {
        "id": "9f1c08909d59992c",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "install_log_write request",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1310,
        "y": 3740,
        "wires": []
    },
    {
        "id": "ecbf3831223e973b",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "debug 3",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2280,
        "y": 3720,
        "wires": []
    },
    {
        "id": "3398d77e23e1794b",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "c7bf8394ca306179",
        "name": "",
        "url": "/wh/get_pollrate",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 250,
        "y": 3520,
        "wires": [
            [
                "57aa8f94105241f5",
                "3352df09b9a72534"
            ]
        ]
    },
    {
        "id": "57aa8f94105241f5",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "c7bf8394ca306179",
        "name": "",
        "links": [
            "630bc9a5a168b928"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 3520,
        "wires": [
            [
                "36e3ce8a1cada8df"
            ]
        ]
    },
    {
        "id": "3352df09b9a72534",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "c7bf8394ca306179",
        "name": "",
        "links": [
            "02c37ccec76242fc"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 550,
        "y": 3580,
        "wires": [
            []
        ]
    },
    {
        "id": "95e9276d0cd029f0",
        "type": "link out",
        "z": "d833cbb1fb389561",
        "g": "c7bf8394ca306179",
        "name": "link out 10",
        "mode": "link",
        "links": [
            "f9b03f4ad3dcce84"
        ],
        "x": 875,
        "y": 3520,
        "wires": []
    },
    {
        "id": "966ff851cbd90656",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "c7bf8394ca306179",
        "name": "",
        "statusCode": "200",
        "headers": {
            "content-type": "text/plain"
        },
        "x": 1140,
        "y": 3460,
        "wires": []
    },
    {
        "id": "661e174eac0360af",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "35cda9524bde7308",
        "name": "set rate",
        "rules": [
            {
                "t": "set",
                "p": "rate",
                "pt": "msg",
                "to": "POLL_RATE",
                "tot": "env"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3560,
        "y": 320,
        "wires": [
            [
                "b17244c965e44e47"
            ]
        ]
    },
    {
        "id": "b17244c965e44e47",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "35cda9524bde7308",
        "name": "set relative rate",
        "func": "msg.rate = msg.rate/3;\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 3720,
        "y": 320,
        "wires": [
            [
                "a549a7852731c409"
            ]
        ]
    },
    {
        "id": "fb08b0419555d43f",
        "type": "delay",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": true,
        "outputs": 1,
        "x": 690,
        "y": 3800,
        "wires": [
            [
                "64265e641987b56e"
            ]
        ]
    },
    {
        "id": "1b250227e9637242",
        "type": "delay",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "",
        "pauseType": "rate",
        "timeout": "5",
        "timeoutUnits": "seconds",
        "rate": "1",
        "nbRateUnits": "1",
        "rateUnits": "second",
        "randomFirst": "1",
        "randomLast": "5",
        "randomUnits": "seconds",
        "drop": false,
        "allowrate": true,
        "outputs": 1,
        "x": 690,
        "y": 4060,
        "wires": [
            [
                "353de0c67305eebc"
            ]
        ]
    },
    {
        "id": "b727c8af0418fe7e",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "a450ee77511a9278",
        "name": "set rate",
        "rules": [
            {
                "t": "set",
                "p": "rate",
                "pt": "msg",
                "to": "POLL_RATE",
                "tot": "env"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 4060,
        "wires": [
            [
                "1b250227e9637242"
            ]
        ]
    },
    {
        "id": "646c8f40d7c70790",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "set rate",
        "rules": [
            {
                "t": "set",
                "p": "rate",
                "pt": "msg",
                "to": "POLL_RATE",
                "tot": "env"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 3800,
        "wires": [
            [
                "fb08b0419555d43f"
            ]
        ]
    },
    {
        "id": "3513276384867acb",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "c7bf8394ca306179",
        "name": "",
        "links": [
            "2eca9639c066f299"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 540,
        "y": 3460,
        "wires": [
            [
                "36e3ce8a1cada8df"
            ]
        ]
    },
    {
        "id": "36e3ce8a1cada8df",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "c7bf8394ca306179",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 730,
        "y": 3460,
        "wires": [
            [
                "b3bf4d2f6e247252"
            ],
            [
                "95e9276d0cd029f0"
            ]
        ]
    },
    {
        "id": "37369d41c7af3b58",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "",
        "property": "unset",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 1990,
        "y": 3920,
        "wires": [
            [
                "511a3388efc3752e"
            ],
            [
                "aa59e3c434587182",
                "511a3388efc3752e"
            ]
        ]
    },
    {
        "id": "aa59e3c434587182",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "0719be1167dcab09",
        "name": "false message",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2200,
        "y": 3860,
        "wires": []
    },
    {
        "id": "84c35db7935f5bd2",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "c7bf8394ca306179",
        "name": "",
        "url": "/wh/get_pollrate_rpi",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 270,
        "y": 3460,
        "wires": [
            [
                "3513276384867acb",
                "3352df09b9a72534"
            ]
        ]
    },
    {
        "id": "b3bf4d2f6e247252",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "c7bf8394ca306179",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "payload",
                "pt": "msg",
                "to": "POLL_RATE",
                "tot": "env"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 940,
        "y": 3460,
        "wires": [
            [
                "966ff851cbd90656"
            ]
        ]
    },
    {
        "id": "5e7a5b2d8894eb52",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "topic rpi-update",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "rpi-update",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 520,
        "y": 1960,
        "wires": [
            [
                "bcbba35118da4437"
            ]
        ]
    },
    {
        "id": "c37815233555c44a",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "url": "/wh/rpi.docker",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 250,
        "y": 1900,
        "wires": [
            [
                "93cc502dae657380",
                "21b4d9da8f0cdd84"
            ]
        ]
    },
    {
        "id": "93cc502dae657380",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "topic docker",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "docker",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 1900,
        "wires": [
            [
                "bcbba35118da4437"
            ]
        ]
    },
    {
        "id": "29650d9b05857482",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "url": "/wh/rpi.docker.sha256",
        "method": "get",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 270,
        "y": 2180,
        "wires": [
            [
                "8b764bf7fc21b98d",
                "db809be1b40dbb41"
            ]
        ]
    },
    {
        "id": "0205ccfce90b03a4",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "get filepath",
        "func": "msg.filepath = env.get(\"DISTRO_PATH\") + \"/docker_update.tar\";\nmsg.filepath_sha = msg.filepath + \".sha256\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1310,
        "y": 1900,
        "wires": [
            [
                "2abfe2a5acc11912"
            ]
        ]
    },
    {
        "id": "2abfe2a5acc11912",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "set tar command",
        "func": "msg.payload = \"tar -cf \" + msg.filepath + \" -C \" + env.get(\"DOCKER_PATH\") + \" .\"\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1510,
        "y": 1900,
        "wires": [
            [
                "c02d77372b37e8eb"
            ]
        ]
    },
    {
        "id": "6d0c0a5f452569d6",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "property": "topic",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "docker",
                "vt": "str"
            },
            {
                "t": "eq",
                "v": "rpi-update",
                "vt": "str"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 1090,
        "y": 1900,
        "wires": [
            [
                "0205ccfce90b03a4"
            ],
            [
                "88e02b79863ab489"
            ]
        ]
    },
    {
        "id": "21b4d9da8f0cdd84",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "links": [
            "02c37ccec76242fc"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 530,
        "y": 1840,
        "wires": [
            []
        ]
    },
    {
        "id": "db809be1b40dbb41",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "get filepath",
        "func": "msg.filepath = env.get(\"DISTRO_PATH\") + \"/docker_update.tar\";\nmsg.filepath_sha = msg.filepath + \".sha256\";\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1010,
        "y": 2180,
        "wires": [
            [
                "f49765dd080e30d7"
            ]
        ]
    },
    {
        "id": "be56b4a06b4e656d",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "7da362d67a6153a1",
        "name": "add encryption",
        "func": "msg.filepath_enc=msg.filepath+\".enc\";\nmsg.payload = \"openssl enc -in \" + msg.filepath + \" \" + env.get(\"CIPHER\") + \" \" + env.get(\"KEY_DERIVATION\") + \" -salt -out \" + msg.filepath_enc + \" -k \" + env.get(\"CRYPTO_KEY\")\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 2860,
        "y": 2260,
        "wires": [
            [
                "12ab915c6d542c9e"
            ]
        ]
    },
    {
        "id": "8b6284ea168e187e",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "8cb8be6fda32d7f8",
        "name": "",
        "statusCode": "200",
        "headers": {
            "content-type": "application/octet-stream"
        },
        "x": 5600,
        "y": 2280,
        "wires": []
    },
    {
        "id": "12ab915c6d542c9e",
        "type": "exec",
        "z": "d833cbb1fb389561",
        "g": "7da362d67a6153a1",
        "command": "",
        "addpay": "payload",
        "append": "",
        "useSpawn": "false",
        "timer": "",
        "winHide": false,
        "oldrc": false,
        "name": "",
        "x": 3010,
        "y": 2260,
        "wires": [
            [
                "32149f8b483830b3"
            ],
            [
                "5a64c488f44c911c"
            ],
            [
                "3514b5af5a0e274d"
            ]
        ]
    },
    {
        "id": "3514b5af5a0e274d",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "7da362d67a6153a1",
        "name": "return code",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 3190,
        "y": 2320,
        "wires": []
    },
    {
        "id": "32149f8b483830b3",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "7da362d67a6153a1",
        "name": "code",
        "property": "rc.code",
        "propertyType": "msg",
        "rules": [
            {
                "t": "eq",
                "v": "0",
                "vt": "num"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 3170,
        "y": 2200,
        "wires": [
            [
                "2707c4c96813d262"
            ],
            [
                "f6271c2949347490"
            ]
        ]
    },
    {
        "id": "5a64c488f44c911c",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "7da362d67a6153a1",
        "name": "tar enctypt error",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "install error",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3200,
        "y": 2260,
        "wires": [
            [
                "fd6140741a737d4f"
            ]
        ]
    },
    {
        "id": "f6271c2949347490",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "7da362d67a6153a1",
        "name": "tar enctypt error",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "install error",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 3400,
        "y": 2240,
        "wires": [
            [
                "fd6140741a737d4f"
            ]
        ]
    },
    {
        "id": "24e8a6613bdc1269",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "",
        "links": [
            "2eca9639c066f299"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 500,
        "y": 1080,
        "wires": [
            [
                "f9f23a667eec2bef"
            ]
        ]
    },
    {
        "id": "a03b9a3bb383a6c4",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "set custom log path",
        "func": "const user = msg.auth_user;\nmsg.filename = env.get(\"LOG_DIR_PATH\") + \"/devices/\" + user + \".log\";\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1570,
        "y": 1000,
        "wires": [
            [
                "d2973f9cf3cbaa04"
            ]
        ]
    },
    {
        "id": "45383a9d65be6b90",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "",
        "links": [
            "98ebafed11752a6c"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 2240,
        "y": 1000,
        "wires": [
            [
                "97c348027b066797"
            ]
        ]
    },
    {
        "id": "97c348027b066797",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "Device log",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 2430,
        "y": 1000,
        "wires": []
    },
    {
        "id": "d2973f9cf3cbaa04",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "format payload into log message",
        "func": "msg.topic = msg.payload.topic;\nif (msg.payload.ts == null){\n    msg.unset=true;\n    msg.payload = \"[\" + (msg.payload.ts/1000).toFixed(2) + \"s delay] WTF\" + msg.payload.message;    \n}\nelse{\n    msg.unset=false;\n    msg.payload = \"[\" + (msg.payload.ts/1000).toFixed(2) + \"s delay] \" + msg.payload.message;\n}\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1810,
        "y": 1000,
        "wires": [
            [
                "d1f23f17fc46753d"
            ]
        ]
    },
    {
        "id": "d1f23f17fc46753d",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "",
        "property": "unset",
        "propertyType": "msg",
        "rules": [
            {
                "t": "false"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "true",
        "repair": false,
        "outputs": 2,
        "x": 2030,
        "y": 1000,
        "wires": [
            [
                "45383a9d65be6b90"
            ],
            [
                "45383a9d65be6b90"
            ]
        ]
    },
    {
        "id": "bfb2eb9a8f8d6bfb",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "Data filtered",
        "active": false,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 1530,
        "y": 1140,
        "wires": []
    },
    {
        "id": "1e305cc28c97ed51",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "",
        "url": "/wh/telemetry",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 230,
        "y": 1180,
        "wires": [
            [
                "525a912dd85ccc15"
            ]
        ]
    },
    {
        "id": "525a912dd85ccc15",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "",
        "links": [
            "2eca9639c066f299"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 500,
        "y": 1180,
        "wires": [
            [
                "d7deb632014c16e0"
            ]
        ]
    },
    {
        "id": "d7deb632014c16e0",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 650,
        "y": 1180,
        "wires": [
            [
                "057e4d3146f652ef"
            ],
            [
                "91447b820a514fdb",
                "007835a0fe153d6c"
            ]
        ]
    },
    {
        "id": "6446d82aa78ee302",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "set response payload",
        "func": "const requiredFields = ['hardware', 'software', 'firmware', 'sensors'];\n\nmsg.payload = new Object;\n\nmsg.payload.success = true;\nmsg.payload.status = `Thanks`;\n\n// Check that all required fields are present\nfor (const field of requiredFields) {\n    if (!(field in msg.data)) {\n        msg.payload.success = false;\n        msg.payload.status = `Missing required field '${field}'.`;\n        return msg;\n    }\n}\n\n// Validate that timestamp can be parsed to an integer\nlet clientTimestamp = Number(msg.data.timestamp);\nif (!Number.isInteger(clientTimestamp)) {\n    msg.payload.success = false;\n    msg.payload.status = 'The \\'timestamp\\' field must be a valid integer.';\n    return msg;\n}\n\nif (clientTimestamp < 1e12) {\n    clientTimestamp *= 1000;\n}\n\n// Count the difference between server and client timestamps\nconst serverTimestamp = Date.now();\nconst timeDifference = serverTimestamp - clientTimestamp;\nmsg.payload.ts = timeDifference;\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1040,
        "y": 1180,
        "wires": [
            [
                "579f3bcc2ad7f947"
            ]
        ]
    },
    {
        "id": "057e4d3146f652ef",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "",
        "rules": [
            {
                "t": "set",
                "p": "data",
                "pt": "msg",
                "to": "payload",
                "tot": "msg",
                "dc": true
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 850,
        "y": 1180,
        "wires": [
            [
                "6446d82aa78ee302"
            ]
        ]
    },
    {
        "id": "73c897c68103b886",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "615fb6bab9daa7e9",
        "name": "delete filename",
        "rules": [
            {
                "t": "delete",
                "p": "filename",
                "pt": "msg"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 5420,
        "y": 840,
        "wires": [
            [
                "4774663de297ff9d"
            ]
        ]
    },
    {
        "id": "27b3fb1d54afe1b0",
        "type": "http in",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "url": "/wh/rpi.check_config",
        "method": "post",
        "upload": false,
        "skipBodyParsing": false,
        "swaggerDoc": "",
        "x": 270,
        "y": 2080,
        "wires": [
            [
                "f98449288618ee58",
                "21b4d9da8f0cdd84"
            ]
        ]
    },
    {
        "id": "f98449288618ee58",
        "type": "change",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "topic check-config",
        "rules": [
            {
                "t": "set",
                "p": "topic",
                "pt": "msg",
                "to": "check-config",
                "tot": "str"
            }
        ],
        "action": "",
        "property": "",
        "from": "",
        "to": "",
        "reg": false,
        "x": 530,
        "y": 2080,
        "wires": [
            [
                "62ad60b8f4c84d7b"
            ]
        ]
    },
    {
        "id": "62ad60b8f4c84d7b",
        "type": "link call",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "links": [
            "2eca9639c066f299"
        ],
        "linkType": "static",
        "timeout": "30",
        "x": 720,
        "y": 2080,
        "wires": [
            [
                "5c6f76197acc8896",
                "ca11aedaabe8fae2"
            ]
        ]
    },
    {
        "id": "5c6f76197acc8896",
        "type": "switch",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "auth success",
        "property": "auth_success",
        "propertyType": "msg",
        "rules": [
            {
                "t": "true"
            },
            {
                "t": "else"
            }
        ],
        "checkall": "false",
        "repair": false,
        "outputs": 2,
        "x": 890,
        "y": 2080,
        "wires": [
            [
                "587fdbfae8454a6c"
            ],
            [
                "7937b805df8b2818"
            ]
        ]
    },
    {
        "id": "9711434968a2f815",
        "type": "http response",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "",
        "statusCode": "200",
        "headers": {
            "Content-Type": "text/plain"
        },
        "x": 1300,
        "y": 2080,
        "wires": []
    },
    {
        "id": "587fdbfae8454a6c",
        "type": "function",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "set response payload",
        "func": "msg.payload = {\n    \"status\": \"Welcome!\",\n    \"success\": true\n}\n\nreturn msg;",
        "outputs": 1,
        "timeout": 0,
        "noerr": 0,
        "initialize": "",
        "finalize": "",
        "libs": [],
        "x": 1120,
        "y": 2080,
        "wires": [
            [
                "9711434968a2f815"
            ]
        ]
    },
    {
        "id": "ca11aedaabe8fae2",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "07eabca516013d9a",
        "name": "debug 4",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 880,
        "y": 2040,
        "wires": []
    },
    {
        "id": "91447b820a514fdb",
        "type": "debug",
        "z": "d833cbb1fb389561",
        "g": "9acd3d3c3a9231f5",
        "name": "debug 5",
        "active": true,
        "tosidebar": true,
        "console": false,
        "tostatus": false,
        "complete": "true",
        "targetType": "full",
        "statusVal": "",
        "statusType": "auto",
        "x": 480,
        "y": 1120,
        "wires": []
    },
    {
        "id": "92a3b4c89af70947",
        "type": "websocket-listener",
        "path": "/ws/log",
        "wholemsg": "false"
    }
]